<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>FLipMouse/FABI ESP32 firmware: /home/beni/sync/Projects/FH/FLipMouse-esp32/main/function_tasks/task_kbd.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">FLipMouse/FABI ESP32 firmware
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_5c982d53a68cdbcd421152b4020263a9.html">main</a></li><li class="navelem"><a class="el" href="dir_dd44d79ba9a472f66a6851d54403189f.html">function_tasks</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">task_kbd.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>FUNCTIONAL TASK - trigger keyboard actions.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="task__kbd_8h_source.html">task_kbd.h</a>&quot;</code><br />
</div>
<p><a href="task__kbd_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a7ce0df38eb467e59f209470c8f5ac4e6"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="task__kbd_8c.html#a7ce0df38eb467e59f209470c8f5ac4e6">LOG_TAG</a>&#160;&#160;&#160;&quot;task_kbd&quot;</td></tr>
<tr class="memdesc:a7ce0df38eb467e59f209470c8f5ac4e6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Logging tag for this module.  <a href="#a7ce0df38eb467e59f209470c8f5ac4e6">More...</a><br /></td></tr>
<tr class="separator:a7ce0df38eb467e59f209470c8f5ac4e6"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a43469aecbc3cd22a6ed1e6a73dc978bf"><td class="memItemLeft" align="right" valign="top">esp_err_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="task__kbd_8c.html#a43469aecbc3cd22a6ed1e6a73dc978bf">task_keyboard_getAT</a> (char *output, void *cfg)</td></tr>
<tr class="memdesc:a43469aecbc3cd22a6ed1e6a73dc978bf"><td class="mdescLeft">&#160;</td><td class="mdescRight">Reverse Parsing - get AT command for keyboard VB.  <a href="#a43469aecbc3cd22a6ed1e6a73dc978bf">More...</a><br /></td></tr>
<tr class="separator:a43469aecbc3cd22a6ed1e6a73dc978bf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7d605cb2407a7a7309911c70e28a9884"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="task__kbd_8c.html#a7d605cb2407a7a7309911c70e28a9884">sendKbd</a> (QueueHandle_t qUSB, QueueHandle_t qBLE, uint16_t *key)</td></tr>
<tr class="memdesc:a7d605cb2407a7a7309911c70e28a9884"><td class="mdescLeft">&#160;</td><td class="mdescRight">Helper function sending to queues depending on connection type.  <a href="#a7d605cb2407a7a7309911c70e28a9884">More...</a><br /></td></tr>
<tr class="separator:a7d605cb2407a7a7309911c70e28a9884"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8ff4618047a049178bfb1d60abfefb5d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="task__kbd_8c.html#a8ff4618047a049178bfb1d60abfefb5d">task_keyboard</a> (<a class="el" href="task__kbd_8h.html#a1ea00a7b13dc2b804f53e6f79cb89f2c">taskKeyboardConfig_t</a> *param)</td></tr>
<tr class="memdesc:a8ff4618047a049178bfb1d60abfefb5d"><td class="mdescLeft">&#160;</td><td class="mdescRight">FUNCTIONAL TASK - trigger keyboard actions.  <a href="#a8ff4618047a049178bfb1d60abfefb5d">More...</a><br /></td></tr>
<tr class="separator:a8ff4618047a049178bfb1d60abfefb5d"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>FUNCTIONAL TASK - trigger keyboard actions. </p>
<p>This file contains the task implementation for keyboard key triggering. This task is started by the configuration task and it is assigned to one virtual button or triggered as single shot. As soon as this button is triggered, the configured keys are sent to either USB, BLE or both. This task can be deleted all the time to change the configuration of one button.</p>
<p>Keycode configuration is set via taskKeyboardConfig_t.</p>
<dl class="section warning"><dt>Warning</dt><dd>Parsing of key identifiers and text is NOT done here. Due to performance reasons, parsing is done prior to initialising/calling this task.</dd></dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="task__kbd_8h.html#a1ea00a7b13dc2b804f53e6f79cb89f2c" title="Config for task_keyboard. ">taskKeyboardConfig_t</a> </dd>
<dd>
<a class="el" href="common_8h.html#a784ceb4b2d4c4fb77baa99646c6e5035">VB_SINGLESHOT</a> </dd></dl>

<p class="definition">Definition in file <a class="el" href="task__kbd_8c_source.html">task_kbd.c</a>.</p>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a id="a7ce0df38eb467e59f209470c8f5ac4e6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7ce0df38eb467e59f209470c8f5ac4e6">&#9670;&nbsp;</a></span>LOG_TAG</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LOG_TAG&#160;&#160;&#160;&quot;task_kbd&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Logging tag for this module. </p>

<p class="definition">Definition at line <a class="el" href="task__kbd_8c_source.html#l00044">44</a> of file <a class="el" href="task__kbd_8c_source.html">task_kbd.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="task__kbd_8c_source.html#l00164">task_keyboard()</a>, and <a class="el" href="task__kbd_8c_source.html#l00055">task_keyboard_getAT()</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="a7d605cb2407a7a7309911c70e28a9884"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7d605cb2407a7a7309911c70e28a9884">&#9670;&nbsp;</a></span>sendKbd()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void sendKbd </td>
          <td>(</td>
          <td class="paramtype">QueueHandle_t&#160;</td>
          <td class="paramname"><em>qUSB</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">QueueHandle_t&#160;</td>
          <td class="paramname"><em>qBLE</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t *&#160;</td>
          <td class="paramname"><em>key</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Helper function sending to queues depending on connection type. </p>
<p>This method is used to send data to USB/BLE queues, depending on the bits of connectionRoutingStatus. Either BLE or USB or both can be enabled. </p><dl class="section see"><dt>See also</dt><dd><a class="el" href="common_8h.html#a9f5db9a2d9f33eb7e1b8e82ca2dffe81">DATATO_USB</a> </dd>
<dd>
<a class="el" href="common_8h.html#a23e20bbc7b5cb196155927ffb1375bed">DATATO_BLE</a> </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">qUSB</td><td>Queue for USB commands to send to </td></tr>
    <tr><td class="paramname">qBLE</td><td>Queue for BLE commands to send to </td></tr>
    <tr><td class="paramname">key</td><td>Pointer to keycode which is sent to these queues </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="task__kbd_8c_source.html#l00144">144</a> of file <a class="el" href="task__kbd_8c_source.html">task_kbd.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="task__kbd_8c_source.html#l00164">task_keyboard()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="task__kbd_8c_a7d605cb2407a7a7309911c70e28a9884_icgraph.png" border="0" usemap="#task__kbd_8c_a7d605cb2407a7a7309911c70e28a9884_icgraph" alt=""/></div>
<map name="task__kbd_8c_a7d605cb2407a7a7309911c70e28a9884_icgraph" id="task__kbd_8c_a7d605cb2407a7a7309911c70e28a9884_icgraph">
<area shape="rect" id="node2" href="task__kbd_8h.html#a8ff4618047a049178bfb1d60abfefb5d" title="FUNCTIONAL TASK &#45; trigger keyboard actions. " alt="" coords="127,31,233,57"/>
<area shape="rect" id="node3" href="config__switcher_8c.html#af5af5079d1982d42e165039e6de7e40a" title="CONTINOUS TASK &#45; Config switcher task, internal config reloading. " alt="" coords="281,5,419,32"/>
<area shape="rect" id="node6" href="task__commands_8c.html#ac3c72c089d32dea93c45f4f9f8d1f244" title="doKeyboardParsing" alt="" coords="283,56,417,83"/>
<area shape="rect" id="node4" href="config__switcher_8h.html#aafed047c8d04b814a85239e031cbad7b" title="Initializing the config switching functionality. " alt="" coords="467,5,593,32"/>
<area shape="rect" id="node5" href="flipmouse__fabi__esp32__kbdmouse__main_8c.html#abce06be17fc37d675118a678a8100a36" title="Main task, created by esp&#45;idf. " alt="" coords="641,5,720,32"/>
</map>
</div>

</div>
</div>
<a id="a8ff4618047a049178bfb1d60abfefb5d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8ff4618047a049178bfb1d60abfefb5d">&#9670;&nbsp;</a></span>task_keyboard()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void task_keyboard </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="task__kbd_8h.html#a1ea00a7b13dc2b804f53e6f79cb89f2c">taskKeyboardConfig_t</a> *&#160;</td>
          <td class="paramname"><em>param</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>FUNCTIONAL TASK - trigger keyboard actions. </p>
<p>This task is used to trigger keyboard actions, as it is defined in taskKeyboardConfig_t. Can be used as singleshot method by using VB_SINGLESHOT as virtual button configuration. </p><dl class="section see"><dt>See also</dt><dd><a class="el" href="common_8h.html#a784ceb4b2d4c4fb77baa99646c6e5035">VB_SINGLESHOT</a> </dd>
<dd>
<a class="el" href="task__kbd_8h.html#a1ea00a7b13dc2b804f53e6f79cb89f2c" title="Config for task_keyboard. ">taskKeyboardConfig_t</a> </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">param</td><td>Task configuration </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="task__kbd_8c_source.html#l00164">164</a> of file <a class="el" href="task__kbd_8c_source.html">task_kbd.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="config__switcher_8c_source.html#l00205">configSwitcherTask()</a>, and <a class="el" href="task__commands_8c_source.html#l00600">doKeyboardParsing()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="task__kbd_8c_a8ff4618047a049178bfb1d60abfefb5d_cgraph.png" border="0" usemap="#task__kbd_8c_a8ff4618047a049178bfb1d60abfefb5d_cgraph" alt=""/></div>
<map name="task__kbd_8c_a8ff4618047a049178bfb1d60abfefb5d_cgraph" id="task__kbd_8c_a8ff4618047a049178bfb1d60abfefb5d_cgraph">
<area shape="rect" id="node2" href="task__kbd_8c.html#a7d605cb2407a7a7309911c70e28a9884" title="Helper function sending to queues depending on connection type. " alt="" coords="160,5,233,32"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="task__kbd_8c_a8ff4618047a049178bfb1d60abfefb5d_icgraph.png" border="0" usemap="#task__kbd_8c_a8ff4618047a049178bfb1d60abfefb5d_icgraph" alt=""/></div>
<map name="task__kbd_8c_a8ff4618047a049178bfb1d60abfefb5d_icgraph" id="task__kbd_8c_a8ff4618047a049178bfb1d60abfefb5d_icgraph">
<area shape="rect" id="node2" href="config__switcher_8c.html#af5af5079d1982d42e165039e6de7e40a" title="CONTINOUS TASK &#45; Config switcher task, internal config reloading. " alt="" coords="160,5,297,32"/>
<area shape="rect" id="node5" href="task__commands_8c.html#ac3c72c089d32dea93c45f4f9f8d1f244" title="doKeyboardParsing" alt="" coords="161,56,296,83"/>
<area shape="rect" id="node3" href="config__switcher_8h.html#aafed047c8d04b814a85239e031cbad7b" title="Initializing the config switching functionality. " alt="" coords="345,5,472,32"/>
<area shape="rect" id="node4" href="flipmouse__fabi__esp32__kbdmouse__main_8c.html#abce06be17fc37d675118a678a8100a36" title="Main task, created by esp&#45;idf. " alt="" coords="520,5,599,32"/>
</map>
</div>

</div>
</div>
<a id="a43469aecbc3cd22a6ed1e6a73dc978bf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a43469aecbc3cd22a6ed1e6a73dc978bf">&#9670;&nbsp;</a></span>task_keyboard_getAT()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">esp_err_t task_keyboard_getAT </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>output</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>cfg</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Reverse Parsing - get AT command for keyboard VB. </p>
<p>This function parses the current configuration of a virtual button to an AT command used to print the configuration. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">output</td><td>Output string, where the full AT command will be stored </td></tr>
    <tr><td class="paramname">cfg</td><td>Pointer to current keyboard configuration, used to parse. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>ESP_OK if everything went fine, ESP_FAIL otherwise </dd></dl>

<p class="definition">Definition at line <a class="el" href="task__kbd_8c_source.html#l00055">55</a> of file <a class="el" href="task__kbd_8c_source.html">task_kbd.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="task__commands_8c_source.html#l01093">printAllSlots()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="task__kbd_8c_a43469aecbc3cd22a6ed1e6a73dc978bf_cgraph.png" border="0" usemap="#task__kbd_8c_a43469aecbc3cd22a6ed1e6a73dc978bf_cgraph" alt=""/></div>
<map name="task__kbd_8c_a43469aecbc3cd22a6ed1e6a73dc978bf_cgraph" id="task__kbd_8c_a43469aecbc3cd22a6ed1e6a73dc978bf_cgraph">
<area shape="rect" id="node2" href="keyboard_8c.html#a027266c03329f00b7bbfefd0e828463c" title="Parse a keycode to a key identifier. " alt="" coords="203,5,373,32"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="task__kbd_8c_a43469aecbc3cd22a6ed1e6a73dc978bf_icgraph.png" border="0" usemap="#task__kbd_8c_a43469aecbc3cd22a6ed1e6a73dc978bf_icgraph" alt=""/></div>
<map name="task__kbd_8c_a43469aecbc3cd22a6ed1e6a73dc978bf_icgraph" id="task__kbd_8c_a43469aecbc3cd22a6ed1e6a73dc978bf_icgraph">
<area shape="rect" id="node2" href="task__commands_8c.html#ad59215648a26578c22baa7ceae099e0e" title="Print the current slot configurations (general settings + VBs) " alt="" coords="203,31,295,57"/>
<area shape="rect" id="node3" href="task__commands_8c.html#a7f6500be563a3dce7f0854fceed02fab" title="doGeneralCmdParsing" alt="" coords="519,5,673,32"/>
<area shape="rect" id="node4" href="task__commands_8c.html#acea81ba8a182ae78feb2db6418fc1806" title="sendErrorBack" alt="" coords="343,56,451,83"/>
<area shape="rect" id="node5" href="task__commands_8c.html#ac3c72c089d32dea93c45f4f9f8d1f244" title="doKeyboardParsing" alt="" coords="529,56,663,83"/>
<area shape="rect" id="node6" href="task__commands_8c.html#a580d9f6a840975525358033a35f761d0" title="doMouseParsing" alt="" coords="537,107,655,133"/>
<area shape="rect" id="node7" href="task__commands_8c.html#a2ad28759e53bb5082853d8d004767115" title="doMouthpieceSettingsParsing" alt="" coords="499,157,693,184"/>
</map>
</div>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
