<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>FLipMouse/FABI ESP32 firmware: /home/beni/sync/Projects/FH/FLipMouse-esp32/main/hal/hal_serial.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">FLipMouse/FABI ESP32 firmware
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_5c982d53a68cdbcd421152b4020263a9.html">main</a></li><li class="navelem"><a class="el" href="dir_2c1795b0295572423fca70fe6201093a.html">hal</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">hal_serial.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>CONTINOUS TASK - This module contains the hardware abstraction for the serial interface to the USB support chip.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="hal__serial_8h_source.html">hal_serial.h</a>&quot;</code><br />
</div>
<p><a href="hal__serial_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a7ce0df38eb467e59f209470c8f5ac4e6"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="hal__serial_8c.html#a7ce0df38eb467e59f209470c8f5ac4e6">LOG_TAG</a>&#160;&#160;&#160;&quot;hal_serial&quot;</td></tr>
<tr class="separator:a7ce0df38eb467e59f209470c8f5ac4e6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a15a73632001c9a59bb02bcb816492923"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="hal__serial_8c.html#a15a73632001c9a59bb02bcb816492923">HAL_SERIAL_TASK_STACKSIZE</a>&#160;&#160;&#160;3072</td></tr>
<tr class="separator:a15a73632001c9a59bb02bcb816492923"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8ed6a618f134d6b923ba216de84253f6"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="hal__serial_8c.html#a8ed6a618f134d6b923ba216de84253f6">HAL_SERIAL_UART_TIMEOUT_MS</a>&#160;&#160;&#160;10000</td></tr>
<tr class="memdesc:a8ed6a618f134d6b923ba216de84253f6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Ticks until the UART receive function has a timeout and gives back received data.*.  <a href="#a8ed6a618f134d6b923ba216de84253f6">More...</a><br /></td></tr>
<tr class="separator:a8ed6a618f134d6b923ba216de84253f6"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a132de0978f07044a393cc1f3b5276ced"><td class="memItemLeft" align="right" valign="top">esp_err_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="hal__serial_8c.html#a132de0978f07044a393cc1f3b5276ced">halSerialSwitchTXChannel</a> (uint8_t target_level, TickType_t ticks_to_wait)</td></tr>
<tr class="separator:a132de0978f07044a393cc1f3b5276ced"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a995c536b9e0d279066d893c6a3dfce4e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="hal__serial_8c.html#a995c536b9e0d279066d893c6a3dfce4e">halSerialFlushRX</a> (void)</td></tr>
<tr class="memdesc:a995c536b9e0d279066d893c6a3dfce4e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Flush Serial RX input buffer.  <a href="#a995c536b9e0d279066d893c6a3dfce4e">More...</a><br /></td></tr>
<tr class="separator:a995c536b9e0d279066d893c6a3dfce4e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab3a538fb88a9732f0afc0188cc3c9c38"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="hal__serial_8c.html#ab3a538fb88a9732f0afc0188cc3c9c38">halSerialRXTask</a> (void *pvParameters)</td></tr>
<tr class="memdesc:ab3a538fb88a9732f0afc0188cc3c9c38"><td class="mdescLeft">&#160;</td><td class="mdescRight">UART RX task for AT command pattern detection and parsing.  <a href="#ab3a538fb88a9732f0afc0188cc3c9c38">More...</a><br /></td></tr>
<tr class="separator:ab3a538fb88a9732f0afc0188cc3c9c38"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6689f99c3a8e5f787a3d995260d8d298"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="hal__serial_8c.html#a6689f99c3a8e5f787a3d995260d8d298">halSerialHIDTask</a> (void *param)</td></tr>
<tr class="memdesc:a6689f99c3a8e5f787a3d995260d8d298"><td class="mdescLeft">&#160;</td><td class="mdescRight">CONTINOUS TASK - Process HID commands &amp; send via HID wire to LPC.  <a href="#a6689f99c3a8e5f787a3d995260d8d298">More...</a><br /></td></tr>
<tr class="separator:a6689f99c3a8e5f787a3d995260d8d298"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0bb04b089362a7c58d189b0fc61bef96"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="hal__serial_8c.html#a0bb04b089362a7c58d189b0fc61bef96">halSerialReceiveUSBSerial</a> (uint8_t **data)</td></tr>
<tr class="memdesc:a0bb04b089362a7c58d189b0fc61bef96"><td class="mdescLeft">&#160;</td><td class="mdescRight">Read parsed AT commands from USB-Serial (USB-CDC)  <a href="#a0bb04b089362a7c58d189b0fc61bef96">More...</a><br /></td></tr>
<tr class="separator:a0bb04b089362a7c58d189b0fc61bef96"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af78683f30da18cfc19c2c91006ec6155"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="hal__serial_8c.html#af78683f30da18cfc19c2c91006ec6155">halSerialSendUSBSerial</a> (char *data, uint32_t length, TickType_t ticks_to_wait)</td></tr>
<tr class="memdesc:af78683f30da18cfc19c2c91006ec6155"><td class="mdescLeft">&#160;</td><td class="mdescRight">Send serial bytes to USB-Serial (USB-CDC)  <a href="#af78683f30da18cfc19c2c91006ec6155">More...</a><br /></td></tr>
<tr class="separator:af78683f30da18cfc19c2c91006ec6155"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab2261f95747ee5806ebdec880d09ca89"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="hal__serial_8c.html#ab2261f95747ee5806ebdec880d09ca89">halSerialReset</a> (uint8_t exceptDevice)</td></tr>
<tr class="memdesc:ab2261f95747ee5806ebdec880d09ca89"><td class="mdescLeft">&#160;</td><td class="mdescRight">Reset the serial HID report data.  <a href="#ab2261f95747ee5806ebdec880d09ca89">More...</a><br /></td></tr>
<tr class="separator:ab2261f95747ee5806ebdec880d09ca89"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a57242c09ec880fbd08e1a4cd5e64d8e5"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="hal__serial_8c.html#a57242c09ec880fbd08e1a4cd5e64d8e5">halSerialRemoveOutputStream</a> (void)</td></tr>
<tr class="memdesc:a57242c09ec880fbd08e1a4cd5e64d8e5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Remove the additional function for outputting the serial data.  <a href="#a57242c09ec880fbd08e1a4cd5e64d8e5">More...</a><br /></td></tr>
<tr class="separator:a57242c09ec880fbd08e1a4cd5e64d8e5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a143968f329a010a1075a81b976579605"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="hal__serial_8c.html#a143968f329a010a1075a81b976579605">halSerialAddOutputStream</a> (<a class="el" href="hal__serial_8h.html#a9645a82bf44ac750418a21920614b3f7">serialoutput_h</a> cb)</td></tr>
<tr class="memdesc:a143968f329a010a1075a81b976579605"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set an additional function for outputting the serial data.  <a href="#a143968f329a010a1075a81b976579605">More...</a><br /></td></tr>
<tr class="separator:a143968f329a010a1075a81b976579605"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad8c9d4288f09a07ec8101e4e25df43d2"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="hal__serial_8c.html#ad8c9d4288f09a07ec8101e4e25df43d2">halSerialHIDFinished</a> (rmt_channel_t channel, void *arg)</td></tr>
<tr class="memdesc:ad8c9d4288f09a07ec8101e4e25df43d2"><td class="mdescLeft">&#160;</td><td class="mdescRight">CB for finished HID output (RMT), releases mutex.  <a href="#ad8c9d4288f09a07ec8101e4e25df43d2">More...</a><br /></td></tr>
<tr class="separator:ad8c9d4288f09a07ec8101e4e25df43d2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2d03c06463b09e33d87d90eb273819b0"><td class="memItemLeft" align="right" valign="top">esp_err_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="hal__serial_8c.html#a2d03c06463b09e33d87d90eb273819b0">halSerialInit</a> (void)</td></tr>
<tr class="memdesc:a2d03c06463b09e33d87d90eb273819b0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize the serial HAL.  <a href="#a2d03c06463b09e33d87d90eb273819b0">More...</a><br /></td></tr>
<tr class="separator:a2d03c06463b09e33d87d90eb273819b0"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:adc58a36fa37939826c6e9b29549b55a6"><td class="memItemLeft" align="right" valign="top">static const int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="hal__serial_8c.html#adc58a36fa37939826c6e9b29549b55a6">BUF_SIZE_RX</a> = 512</td></tr>
<tr class="separator:adc58a36fa37939826c6e9b29549b55a6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4ef85c128c2cb518b3771191c8a27e3d"><td class="memItemLeft" align="right" valign="top"><a class="el" href="hal__serial_8h.html#a9645a82bf44ac750418a21920614b3f7">serialoutput_h</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="hal__serial_8c.html#a4ef85c128c2cb518b3771191c8a27e3d">outputcb</a> = NULL</td></tr>
<tr class="memdesc:a4ef85c128c2cb518b3771191c8a27e3d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Output callback.  <a href="#a4ef85c128c2cb518b3771191c8a27e3d">More...</a><br /></td></tr>
<tr class="separator:a4ef85c128c2cb518b3771191c8a27e3d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad0911c183882187e70480f1925cc0c55"><td class="memItemLeft" align="right" valign="top">static const int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="hal__serial_8c.html#ad0911c183882187e70480f1925cc0c55">CMDQUEUE_SIZE</a> = 256</td></tr>
<tr class="memdesc:ad0911c183882187e70480f1925cc0c55"><td class="mdescLeft">&#160;</td><td class="mdescRight">Length of queue for AT commands.  <a href="#ad0911c183882187e70480f1925cc0c55">More...</a><br /></td></tr>
<tr class="separator:ad0911c183882187e70480f1925cc0c55"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8742cd480180fcaba3079eb3c707bb0e"><td class="memItemLeft" align="right" valign="top">static const int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="hal__serial_8c.html#a8742cd480180fcaba3079eb3c707bb0e">BUF_SIZE_TX</a> = 512</td></tr>
<tr class="separator:a8742cd480180fcaba3079eb3c707bb0e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af8aa2305d1905c876a30e25bf34cc480"><td class="memItemLeft" align="right" valign="top">static SemaphoreHandle_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="hal__serial_8c.html#af8aa2305d1905c876a30e25bf34cc480">serialsendingsem</a></td></tr>
<tr class="memdesc:af8aa2305d1905c876a30e25bf34cc480"><td class="mdescLeft">&#160;</td><td class="mdescRight">Mutex for sending to serial port.  <a href="#af8aa2305d1905c876a30e25bf34cc480">More...</a><br /></td></tr>
<tr class="separator:af8aa2305d1905c876a30e25bf34cc480"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af2a7c6dc7be333dca54efb59230e5684"><td class="memItemLeft" align="right" valign="top">static SemaphoreHandle_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="hal__serial_8c.html#af2a7c6dc7be333dca54efb59230e5684">hidsendingsem</a></td></tr>
<tr class="memdesc:af2a7c6dc7be333dca54efb59230e5684"><td class="mdescLeft">&#160;</td><td class="mdescRight">Mutex for sending to HID.  <a href="#af2a7c6dc7be333dca54efb59230e5684">More...</a><br /></td></tr>
<tr class="separator:af2a7c6dc7be333dca54efb59230e5684"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>CONTINOUS TASK - This module contains the hardware abstraction for the serial interface to the USB support chip. </p>
<p>Attention: this module does NOT use UART0 (terminal &amp; program interface)</p>
<p>The hardware abstraction takes care of:</p><ul>
<li>sending USB-HID commands</li>
<li>sending USB-serial responses</li>
<li>sending/receiving serial data (to/from USB-serial)</li>
</ul>
<p>The interaction to other parts of the firmware consists of:</p><ul>
<li>pending on queue for USB commands: hid_usb</li>
<li>halSerialSendUSBSerial / halSerialReceiveUSBSerial for direct sending/receiving (USB-CDC)</li>
</ul>
<p>The received serial data can be used by different modules, currently the task_commands is used to fetch &amp; parse serial data.</p>
<dl class="section note"><dt>Note</dt><dd>In this firmware, there are 3 pins routed to the USB support chip (RX,TX,HID). RX/TX lines are used as normal UART, which is converted by the LPC USB chip to the USB-CDC interface. The third line (HID) is used as a pulse length modulated output for transmitting HID commands to the host. </dd></dl>

<p class="definition">Definition in file <a class="el" href="hal__serial_8c_source.html">hal_serial.c</a>.</p>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a id="a15a73632001c9a59bb02bcb816492923"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a15a73632001c9a59bb02bcb816492923">&#9670;&nbsp;</a></span>HAL_SERIAL_TASK_STACKSIZE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define HAL_SERIAL_TASK_STACKSIZE&#160;&#160;&#160;3072</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="hal__serial_8c_source.html#l00050">50</a> of file <a class="el" href="hal__serial_8c_source.html">hal_serial.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="hal__serial_8c_source.html#l00561">halSerialInit()</a>.</p>

</div>
</div>
<a id="a8ed6a618f134d6b923ba216de84253f6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8ed6a618f134d6b923ba216de84253f6">&#9670;&nbsp;</a></span>HAL_SERIAL_UART_TIMEOUT_MS</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define HAL_SERIAL_UART_TIMEOUT_MS&#160;&#160;&#160;10000</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Ticks until the UART receive function has a timeout and gives back received data.*. </p>
<p>This value should be adjusted, either if the maximum length of a transmitted command OR the baudrate is changed. If you adjust the</p>
<p>Currently, the value 30ms reflects 115k2 baud and 256 bytes for one AT command:</p><ul>
<li>~87us are necessary for 1 byte (115k2 baud + 10 bit times) <br />
</li>
<li>~22ms are necessary for maximum command length</li>
</ul>
<p>-&gt; next bigger value reflectable in ticks is 30ms.</p>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="common_8h.html#a0a9fad923b344cf2efca72441a81817a" title="maximum length for an AT command (including parameters &amp; &#39;AT &#39;, e.g., macro text) ...">ATCMD_LENGTH</a> </dd></dl>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000025">Todo:</a></b></dt><dd>Documentation updates, this define is now used differently... </dd></dl>

<p class="definition">Definition at line <a class="el" href="hal__serial_8c_source.html#l00067">67</a> of file <a class="el" href="hal__serial_8c_source.html">hal_serial.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="hal__serial_8c_source.html#l00408">halSerialReceiveUSBSerial()</a>.</p>

</div>
</div>
<a id="a7ce0df38eb467e59f209470c8f5ac4e6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7ce0df38eb467e59f209470c8f5ac4e6">&#9670;&nbsp;</a></span>LOG_TAG</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LOG_TAG&#160;&#160;&#160;&quot;hal_serial&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="hal__serial_8c_source.html#l00049">49</a> of file <a class="el" href="hal__serial_8c_source.html">hal_serial.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="hal__serial_8c_source.html#l00279">halSerialHIDTask()</a>, <a class="el" href="hal__serial_8c_source.html#l00561">halSerialInit()</a>, <a class="el" href="hal__serial_8c_source.html#l00408">halSerialReceiveUSBSerial()</a>, <a class="el" href="hal__serial_8c_source.html#l00486">halSerialReset()</a>, <a class="el" href="hal__serial_8c_source.html#l00135">halSerialRXTask()</a>, and <a class="el" href="hal__serial_8c_source.html#l00441">halSerialSendUSBSerial()</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="a143968f329a010a1075a81b976579605"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a143968f329a010a1075a81b976579605">&#9670;&nbsp;</a></span>halSerialAddOutputStream()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void halSerialAddOutputStream </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="hal__serial_8h.html#a9645a82bf44ac750418a21920614b3f7">serialoutput_h</a>&#160;</td>
          <td class="paramname"><em>cb</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set an additional function for outputting the serial data. </p>
<p>This function sets a callback, which is used if the program needs an additional output despite the serial interface. In this case, the webgui registers a callback, which sends all the serial data to the websocket </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">cb</td><td>Function callback </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="hal__serial_8c_source.html#l00545">545</a> of file <a class="el" href="hal__serial_8c_source.html">hal_serial.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="task__webgui_8c_source.html#l00315">wifi_event_handler()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="hal__serial_8c_a143968f329a010a1075a81b976579605_icgraph.png" border="0" usemap="#hal__serial_8c_a143968f329a010a1075a81b976579605_icgraph" alt=""/></div>
<map name="hal__serial_8c_a143968f329a010a1075a81b976579605_icgraph" id="hal__serial_8c_a143968f329a010a1075a81b976579605_icgraph">
<area shape="rect" id="node2" href="task__webgui_8c.html#a11dd6a5edc46c297b26382ebce3c34cb" title="Event handler for wifi status updates. " alt="" coords="229,5,360,32"/>
<area shape="rect" id="node3" href="task__webgui_8h.html#a669b9245d5040c0162481f7b24dbeea7" title="Init the web / DNS server and the web gui. " alt="" coords="408,5,524,32"/>
<area shape="rect" id="node4" href="flipmouse__fabi__esp32__kbdmouse__main_8c.html#abce06be17fc37d675118a678a8100a36" title="Main task, created by esp&#45;idf. " alt="" coords="572,5,651,32"/>
</map>
</div>

</div>
</div>
<a id="a995c536b9e0d279066d893c6a3dfce4e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a995c536b9e0d279066d893c6a3dfce4e">&#9670;&nbsp;</a></span>halSerialFlushRX()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void halSerialFlushRX </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Flush Serial RX input buffer. </p>

<p class="definition">Definition at line <a class="el" href="hal__serial_8c_source.html#l00121">121</a> of file <a class="el" href="hal__serial_8c_source.html">hal_serial.c</a>.</p>

</div>
</div>
<a id="ad8c9d4288f09a07ec8101e4e25df43d2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad8c9d4288f09a07ec8101e4e25df43d2">&#9670;&nbsp;</a></span>halSerialHIDFinished()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void halSerialHIDFinished </td>
          <td>(</td>
          <td class="paramtype">rmt_channel_t&#160;</td>
          <td class="paramname"><em>channel</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>arg</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>CB for finished HID output (RMT), releases mutex. </p>

<p class="definition">Definition at line <a class="el" href="hal__serial_8c_source.html#l00551">551</a> of file <a class="el" href="hal__serial_8c_source.html">hal_serial.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="hal__serial_8c_source.html#l00561">halSerialInit()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="hal__serial_8c_ad8c9d4288f09a07ec8101e4e25df43d2_icgraph.png" border="0" usemap="#hal__serial_8c_ad8c9d4288f09a07ec8101e4e25df43d2_icgraph" alt=""/></div>
<map name="hal__serial_8c_ad8c9d4288f09a07ec8101e4e25df43d2_icgraph" id="hal__serial_8c_ad8c9d4288f09a07ec8101e4e25df43d2_icgraph">
<area shape="rect" id="node2" href="hal__serial_8h.html#a2d03c06463b09e33d87d90eb273819b0" title="Initialize the serial HAL. " alt="" coords="199,5,289,32"/>
<area shape="rect" id="node3" href="flipmouse__fabi__esp32__kbdmouse__main_8c.html#abce06be17fc37d675118a678a8100a36" title="Main task, created by esp&#45;idf. " alt="" coords="337,5,416,32"/>
</map>
</div>

</div>
</div>
<a id="a6689f99c3a8e5f787a3d995260d8d298"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6689f99c3a8e5f787a3d995260d8d298">&#9670;&nbsp;</a></span>halSerialHIDTask()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void halSerialHIDTask </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>param</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>CONTINOUS TASK - Process HID commands &amp; send via HID wire to LPC. </p>
<p>This task is used to receive a byte buffer, which contains a HID command for the LPC. These bytes are converted into either long or short pulses for 0 and 1 bits, finished by a "very long" stop bit.</p>
<p>HID commands are built up following this declarations: Byte 0: type of command: K/M/J/C:</p><ul>
<li>K are keyboard reports</li>
<li>M are mouse reports</li>
<li>J are joystick reports</li>
<li>C are set locale commands</li>
</ul>
<p>Following parameter lenghts are valid: "K": 7 Bytes; 1 modifier + 6 keycode "M": 4 Bytes; Button mask + X + Y + wheel "J": 13 Bytes; Please consult <a class="el" href="task__joystick_8c.html" title="FUNCTIONAL TASK - joystick handling. ">task_joystick.c</a> for a detailed explanation "C": 1 Byte; Locale code, according to HID specification chapter 6.2.1</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">param</td><td>Unused </td></tr>
  </table>
  </dd>
</dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="common_8h.html#a88d5a24e12401a0a28db04395ec8dadb">usb_command_t</a> </dd>
<dd>
<a class="el" href="common_8h.html#a841902610ed5a9d5ee171749a85a8b8c" title="Queue for sending HID commands to USB. ">hid_usb</a> </dd>
<dd>
<a class="el" href="hal__serial_8h.html#ad7dfbc49dc0771980304ac82bbe85a47">HAL_SERIAL_HIDPIN</a> </dd></dl>
<dl class="section note"><dt>Note</dt><dd>Due to the nature of absolute values for some HID input, it is sometimes wanted to update only relative values (e.g. move mouse, but don't change mouse button status). To support only updates of partial reports, the LPC chip supports a feature where the absolute value is NOT changed by sending 0xFF for the corresponding byte. Currently following bytefields support this:<ul>
<li>Mouse: buttons </li>
</ul>
</dd></dl>

<p class="definition">Definition at line <a class="el" href="hal__serial_8c_source.html#l00279">279</a> of file <a class="el" href="hal__serial_8c_source.html">hal_serial.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="hal__serial_8c_source.html#l00561">halSerialInit()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="hal__serial_8c_a6689f99c3a8e5f787a3d995260d8d298_icgraph.png" border="0" usemap="#hal__serial_8c_a6689f99c3a8e5f787a3d995260d8d298_icgraph" alt=""/></div>
<map name="hal__serial_8c_a6689f99c3a8e5f787a3d995260d8d298_icgraph" id="hal__serial_8c_a6689f99c3a8e5f787a3d995260d8d298_icgraph">
<area shape="rect" id="node2" href="hal__serial_8h.html#a2d03c06463b09e33d87d90eb273819b0" title="Initialize the serial HAL. " alt="" coords="179,5,269,32"/>
<area shape="rect" id="node3" href="flipmouse__fabi__esp32__kbdmouse__main_8c.html#abce06be17fc37d675118a678a8100a36" title="Main task, created by esp&#45;idf. " alt="" coords="317,5,396,32"/>
</map>
</div>

</div>
</div>
<a id="a2d03c06463b09e33d87d90eb273819b0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2d03c06463b09e33d87d90eb273819b0">&#9670;&nbsp;</a></span>halSerialInit()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">esp_err_t halSerialInit </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize the serial HAL. </p>
<p>This method initializes the serial interface &amp; creates all necessary tasks. </p>

<p class="definition">Definition at line <a class="el" href="hal__serial_8c_source.html#l00561">561</a> of file <a class="el" href="hal__serial_8c_source.html">hal_serial.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="flipmouse__fabi__esp32__kbdmouse__main_8c_source.html#l00120">app_main()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="hal__serial_8c_a2d03c06463b09e33d87d90eb273819b0_cgraph.png" border="0" usemap="#hal__serial_8c_a2d03c06463b09e33d87d90eb273819b0_cgraph" alt=""/></div>
<map name="hal__serial_8c_a2d03c06463b09e33d87d90eb273819b0_cgraph" id="hal__serial_8c_a2d03c06463b09e33d87d90eb273819b0_cgraph">
<area shape="rect" id="node2" href="hal__serial_8c.html#ad8c9d4288f09a07ec8101e4e25df43d2" title="CB for finished HID output (RMT), releases mutex. " alt="" coords="144,5,289,32"/>
<area shape="rect" id="node3" href="hal__serial_8c.html#a6689f99c3a8e5f787a3d995260d8d298" title="CONTINOUS TASK &#45; Process HID commands &amp; send via HID wire to LPC. " alt="" coords="154,56,279,83"/>
<area shape="rect" id="node4" href="hal__serial_8c.html#ab3a538fb88a9732f0afc0188cc3c9c38" title="UART RX task for AT command pattern detection and parsing. " alt="" coords="157,107,277,133"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="hal__serial_8c_a2d03c06463b09e33d87d90eb273819b0_icgraph.png" border="0" usemap="#hal__serial_8c_a2d03c06463b09e33d87d90eb273819b0_icgraph" alt=""/></div>
<map name="hal__serial_8c_a2d03c06463b09e33d87d90eb273819b0_icgraph" id="hal__serial_8c_a2d03c06463b09e33d87d90eb273819b0_icgraph">
<area shape="rect" id="node2" href="flipmouse__fabi__esp32__kbdmouse__main_8c.html#abce06be17fc37d675118a678a8100a36" title="Main task, created by esp&#45;idf. " alt="" coords="144,5,223,32"/>
</map>
</div>

</div>
</div>
<a id="a0bb04b089362a7c58d189b0fc61bef96"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0bb04b089362a7c58d189b0fc61bef96">&#9670;&nbsp;</a></span>halSerialReceiveUSBSerial()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int halSerialReceiveUSBSerial </td>
          <td>(</td>
          <td class="paramtype">uint8_t **&#160;</td>
          <td class="paramname"><em>data</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Read parsed AT commands from USB-Serial (USB-CDC) </p>
<p>This method reads full AT commands from the halSerialATCmds queue.</p>
<dl class="section return"><dt>Returns</dt><dd>-1 on error, number of read bytes otherwise </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">data</td><td>Double pointer to save the new allocated buffer to. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section warning"><dt>Warning</dt><dd>Free the data pointer after use! </dd></dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="hal__serial_8c.html#a8ed6a618f134d6b923ba216de84253f6" title="Ticks until the UART receive function has a timeout and gives back received data.*. ">HAL_SERIAL_UART_TIMEOUT_MS</a> </dd>
<dd>
<a class="el" href="hal__serial_8h.html#a57deadb7de70a0230474a4680cc0e2d9" title="Queue for parsed AT commands. ">halSerialATCmds</a> </dd>
<dd>
<a class="el" href="hal__serial_8c.html#ab3a538fb88a9732f0afc0188cc3c9c38" title="UART RX task for AT command pattern detection and parsing. ">halSerialRXTask</a> </dd></dl>

<p class="definition">Definition at line <a class="el" href="hal__serial_8c_source.html#l00408">408</a> of file <a class="el" href="hal__serial_8c_source.html">hal_serial.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="task__commands_8c_source.html#l01386">task_commands()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="hal__serial_8c_a0bb04b089362a7c58d189b0fc61bef96_icgraph.png" border="0" usemap="#hal__serial_8c_a0bb04b089362a7c58d189b0fc61bef96_icgraph" alt=""/></div>
<map name="hal__serial_8c_a0bb04b089362a7c58d189b0fc61bef96_icgraph" id="hal__serial_8c_a0bb04b089362a7c58d189b0fc61bef96_icgraph">
<area shape="rect" id="node2" href="task__commands_8c.html#a7b36c39275d773aaedcb327ef4e1516f" title="task_commands" alt="" coords="235,31,353,57"/>
<area shape="rect" id="node3" href="task__commands_8h.html#aedb896e40753227f80768e09d3748419" title="Init the command parser. " alt="" coords="414,5,546,32"/>
<area shape="rect" id="node5" href="task__commands_8h.html#a26091155b4d85093239033d689f363d0" title="Restart the command parser task. " alt="" coords="401,56,559,83"/>
<area shape="rect" id="node4" href="flipmouse__fabi__esp32__kbdmouse__main_8c.html#abce06be17fc37d675118a678a8100a36" title="Main task, created by esp&#45;idf. " alt="" coords="607,5,685,32"/>
</map>
</div>

</div>
</div>
<a id="a57242c09ec880fbd08e1a4cd5e64d8e5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a57242c09ec880fbd08e1a4cd5e64d8e5">&#9670;&nbsp;</a></span>halSerialRemoveOutputStream()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void halSerialRemoveOutputStream </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Remove the additional function for outputting the serial data. </p>
<p>This function removes the callback, which is used if the program needs an additional output despite the serial interface. </p>

<p class="definition">Definition at line <a class="el" href="hal__serial_8c_source.html#l00532">532</a> of file <a class="el" href="hal__serial_8c_source.html">hal_serial.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="task__webgui_8c_source.html#l00315">wifi_event_handler()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="hal__serial_8c_a57242c09ec880fbd08e1a4cd5e64d8e5_icgraph.png" border="0" usemap="#hal__serial_8c_a57242c09ec880fbd08e1a4cd5e64d8e5_icgraph" alt=""/></div>
<map name="hal__serial_8c_a57242c09ec880fbd08e1a4cd5e64d8e5_icgraph" id="hal__serial_8c_a57242c09ec880fbd08e1a4cd5e64d8e5_icgraph">
<area shape="rect" id="node2" href="task__webgui_8c.html#a11dd6a5edc46c297b26382ebce3c34cb" title="Event handler for wifi status updates. " alt="" coords="256,5,387,32"/>
<area shape="rect" id="node3" href="task__webgui_8h.html#a669b9245d5040c0162481f7b24dbeea7" title="Init the web / DNS server and the web gui. " alt="" coords="435,5,551,32"/>
<area shape="rect" id="node4" href="flipmouse__fabi__esp32__kbdmouse__main_8c.html#abce06be17fc37d675118a678a8100a36" title="Main task, created by esp&#45;idf. " alt="" coords="599,5,677,32"/>
</map>
</div>

</div>
</div>
<a id="ab2261f95747ee5806ebdec880d09ca89"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab2261f95747ee5806ebdec880d09ca89">&#9670;&nbsp;</a></span>halSerialReset()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void halSerialReset </td>
          <td>(</td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>exceptDevice</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Reset the serial HID report data. </p>
<p>Used for slot/config switchers. It resets the keycode array and sets all HID reports to 0 (release all keys, avoiding sticky keys on a config change) </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">exceptDevice</td><td>if you want to reset only a part of the devices, set flags accordingly:</td></tr>
  </table>
  </dd>
</dl>
<p>(1&lt;&lt;0) excepts keyboard (1&lt;&lt;1) excepts joystick (1&lt;&lt;2) excepts mouse If nothing is set (exceptDevice = 0) all are reset </p>

<p class="definition">Definition at line <a class="el" href="hal__serial_8c_source.html#l00486">486</a> of file <a class="el" href="hal__serial_8c_source.html">hal_serial.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="config__switcher_8c_source.html#l00280">configSwitcherTask()</a>, and <a class="el" href="task__commands_8c_source.html#l00757">doGeneralCmdParsing()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="hal__serial_8c_ab2261f95747ee5806ebdec880d09ca89_icgraph.png" border="0" usemap="#hal__serial_8c_ab2261f95747ee5806ebdec880d09ca89_icgraph" alt=""/></div>
<map name="hal__serial_8c_ab2261f95747ee5806ebdec880d09ca89_icgraph" id="hal__serial_8c_ab2261f95747ee5806ebdec880d09ca89_icgraph">
<area shape="rect" id="node2" href="config__switcher_8c.html#af5af5079d1982d42e165039e6de7e40a" title="CONTINOUS TASK &#45; Config switcher task, internal config reloading. " alt="" coords="168,5,305,32"/>
<area shape="rect" id="node5" href="task__commands_8c.html#a7f6500be563a3dce7f0854fceed02fab" title="doGeneralCmdParsing" alt="" coords="160,56,313,83"/>
<area shape="rect" id="node3" href="config__switcher_8h.html#aafed047c8d04b814a85239e031cbad7b" title="Initializing the config switching functionality. " alt="" coords="361,5,488,32"/>
<area shape="rect" id="node4" href="flipmouse__fabi__esp32__kbdmouse__main_8c.html#abce06be17fc37d675118a678a8100a36" title="Main task, created by esp&#45;idf. " alt="" coords="741,31,820,57"/>
<area shape="rect" id="node6" href="task__commands_8c.html#a7b36c39275d773aaedcb327ef4e1516f" title="task_commands" alt="" coords="365,56,484,83"/>
<area shape="rect" id="node7" href="task__commands_8h.html#aedb896e40753227f80768e09d3748419" title="Init the command parser. " alt="" coords="549,56,681,83"/>
<area shape="rect" id="node8" href="task__commands_8h.html#a26091155b4d85093239033d689f363d0" title="Restart the command parser task. " alt="" coords="536,107,693,133"/>
</map>
</div>

</div>
</div>
<a id="ab3a538fb88a9732f0afc0188cc3c9c38"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab3a538fb88a9732f0afc0188cc3c9c38">&#9670;&nbsp;</a></span>halSerialRXTask()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void halSerialRXTask </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>pvParameters</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>UART RX task for AT command pattern detection and parsing. </p>
<p>This task is used to pend on any incoming UART bytes. After receiving bytes, the incoming data is put together into AT commands. On a fully received AT command (terminated either by '\r' or '\n'), the buffer will be sent to the halSerialATCmds queue.</p>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="hal__serial_8h.html#a57deadb7de70a0230474a4680cc0e2d9" title="Queue for parsed AT commands. ">halSerialATCmds</a> </dd></dl>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000026">Todo:</a></b></dt><dd>When CIM mode is active, switch back here to AT mode </dd></dl>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000027">Todo:</a></b></dt><dd>Activate CIM mode here. </dd></dl>

<p class="definition">Definition at line <a class="el" href="hal__serial_8c_source.html#l00135">135</a> of file <a class="el" href="hal__serial_8c_source.html">hal_serial.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="hal__serial_8c_source.html#l00561">halSerialInit()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="hal__serial_8c_ab3a538fb88a9732f0afc0188cc3c9c38_icgraph.png" border="0" usemap="#hal__serial_8c_ab3a538fb88a9732f0afc0188cc3c9c38_icgraph" alt=""/></div>
<map name="hal__serial_8c_ab3a538fb88a9732f0afc0188cc3c9c38_icgraph" id="hal__serial_8c_ab3a538fb88a9732f0afc0188cc3c9c38_icgraph">
<area shape="rect" id="node2" href="hal__serial_8h.html#a2d03c06463b09e33d87d90eb273819b0" title="Initialize the serial HAL. " alt="" coords="173,5,264,32"/>
<area shape="rect" id="node3" href="flipmouse__fabi__esp32__kbdmouse__main_8c.html#abce06be17fc37d675118a678a8100a36" title="Main task, created by esp&#45;idf. " alt="" coords="312,5,391,32"/>
</map>
</div>

</div>
</div>
<a id="af78683f30da18cfc19c2c91006ec6155"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af78683f30da18cfc19c2c91006ec6155">&#9670;&nbsp;</a></span>halSerialSendUSBSerial()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int halSerialSendUSBSerial </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>length</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">TickType_t&#160;</td>
          <td class="paramname"><em>ticks_to_wait</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Send serial bytes to USB-Serial (USB-CDC) </p>
<p>This method sends bytes to the UART, for USB-CDC</p>
<dl class="section return"><dt>Returns</dt><dd>-1 on error, number of read bytes otherwise </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">data</td><td>Data to be sent </td></tr>
    <tr><td class="paramname">length</td><td>Number of maximum bytes to send </td></tr>
    <tr><td class="paramname">ticks_to_wait</td><td>Maximum time to wait for a free UART </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="hal__serial_8c_source.html#l00441">441</a> of file <a class="el" href="hal__serial_8c_source.html">hal_serial.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="task__commands_8c_source.html#l00757">doGeneralCmdParsing()</a>, <a class="el" href="task__commands_8c_source.html#l00597">doInfraredParsing()</a>, <a class="el" href="hal__adc_8c_source.html#l00211">halAdcReportRaw()</a>, <a class="el" href="task__infrared_8c_source.html#l00153">infrared_record()</a>, <a class="el" href="task__commands_8c_source.html#l01589">printAllSlots()</a>, <a class="el" href="task__debouncer_8c_source.html#l00151">sendButtonLearn()</a>, <a class="el" href="task__commands_8c_source.html#l00110">sendErrorBack()</a>, and <a class="el" href="task__commands_8c_source.html#l01386">task_commands()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="hal__serial_8c_af78683f30da18cfc19c2c91006ec6155_icgraph.png" border="0" usemap="#hal__serial_8c_af78683f30da18cfc19c2c91006ec6155_icgraph" alt=""/></div>
<map name="hal__serial_8c_af78683f30da18cfc19c2c91006ec6155_icgraph" id="hal__serial_8c_af78683f30da18cfc19c2c91006ec6155_icgraph">
<area shape="rect" id="node2" href="task__commands_8c.html#a7f6500be563a3dce7f0854fceed02fab" title="doGeneralCmdParsing" alt="" coords="1335,284,1489,311"/>
<area shape="rect" id="node3" href="task__commands_8c.html#a7b36c39275d773aaedcb327ef4e1516f" title="task_commands" alt="" coords="1561,309,1680,336"/>
<area shape="rect" id="node7" href="task__commands_8c.html#a937cdeb2f02b0c5d9a0f94a0f69e9328" title="doInfraredParsing" alt="" coords="411,233,535,260"/>
<area shape="rect" id="node8" href="hal__adc_8c.html#a8743abcde6f190545c429f072c16106d" title="Report raw values via serial interface. " alt="" coords="216,81,344,108"/>
<area shape="rect" id="node15" href="task__commands_8c.html#ad59215648a26578c22baa7ceae099e0e" title="Print the current slot configurations (general settings + VBs) " alt="" coords="989,335,1081,361"/>
<area shape="rect" id="node16" href="task__commands_8c.html#acea81ba8a182ae78feb2db6418fc1806" title="sendErrorBack" alt="" coords="1144,385,1252,412"/>
<area shape="rect" id="node21" href="task__infrared_8h.html#a3b5b7c90c92398748f28c75b55edccda" title="Trigger an IR command recording. " alt="" coords="226,183,334,209"/>
<area shape="rect" id="node22" href="task__debouncer_8c.html#ad74310b1470085c358d1c3601609fcf6" title="Send feedback on pressed buttons to host (for button learning) " alt="" coords="220,17,340,44"/>
<area shape="rect" id="node4" href="task__commands_8h.html#aedb896e40753227f80768e09d3748419" title="Init the command parser. " alt="" coords="1745,309,1877,336"/>
<area shape="rect" id="node6" href="task__commands_8h.html#a26091155b4d85093239033d689f363d0" title="Restart the command parser task. " alt="" coords="1732,259,1889,285"/>
<area shape="rect" id="node5" href="flipmouse__fabi__esp32__kbdmouse__main_8c.html#abce06be17fc37d675118a678a8100a36" title="Main task, created by esp&#45;idf. " alt="" coords="1937,81,2016,108"/>
<area shape="rect" id="node9" href="hal__adc_8c.html#a78419739020988cffc83ffcbc7103b05" title="Process pressure sensor (sip &amp; puff) " alt="" coords="392,107,555,133"/>
<area shape="rect" id="node10" href="hal__adc_8c.html#aee719704e643d27c1faab768cf4bc22e" title="HAL TASK &#45; Threshold task for ADC. " alt="" coords="603,107,751,133"/>
<area shape="rect" id="node11" href="hal__adc_8h.html#a4135bb73c2271b4a27db8d8d81884de7" title="Reload ADC config. " alt="" coords="799,107,941,133"/>
<area shape="rect" id="node12" href="config__switcher_8c.html#af5af5079d1982d42e165039e6de7e40a" title="CONTINOUS TASK &#45; Config switcher task, internal config reloading. " alt="" coords="1129,56,1267,83"/>
<area shape="rect" id="node14" href="hal__adc_8h.html#a6f0d302f35e5b7f7a1144f0ddace35d2" title="Init the ADC driver module. " alt="" coords="995,107,1075,133"/>
<area shape="rect" id="node13" href="config__switcher_8h.html#aafed047c8d04b814a85239e031cbad7b" title="Initializing the config switching functionality. " alt="" coords="1557,56,1684,83"/>
<area shape="rect" id="node17" href="task__commands_8c.html#afc7ebe31a124c2102f8b41577b6dc5b0" title="doJoystickParsing" alt="" coords="1347,335,1477,361"/>
<area shape="rect" id="node18" href="task__commands_8c.html#ac3c72c089d32dea93c45f4f9f8d1f244" title="doKeyboardParsing" alt="" coords="1345,385,1479,412"/>
<area shape="rect" id="node19" href="task__commands_8c.html#a580d9f6a840975525358033a35f761d0" title="doMouseParsing" alt="" coords="1353,436,1471,463"/>
<area shape="rect" id="node20" href="task__commands_8c.html#a2ad28759e53bb5082853d8d004767115" title="doMouthpieceSettingsParsing" alt="" coords="1315,487,1509,513"/>
<area shape="rect" id="node23" href="task__debouncer_8c.html#a4a76abdbb849aa0bbc66aa001c6f4af9" title="Timer callback for debouncing. " alt="" coords="407,5,540,32"/>
<area shape="rect" id="node24" href="task__debouncer_8c.html#a2d41ed2a246a1b8d4ee5510262001e50" title="Start a debouncing timer with given debounce time and VB number. " alt="" coords="636,5,717,32"/>
<area shape="rect" id="node25" href="task__debouncer_8h.html#a79d88e490be7198b9cc37556c66b837b" title="Debouncing main task. " alt="" coords="813,5,927,32"/>
</map>
</div>

</div>
</div>
<a id="a132de0978f07044a393cc1f3b5276ced"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a132de0978f07044a393cc1f3b5276ced">&#9670;&nbsp;</a></span>halSerialSwitchTXChannel()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">esp_err_t halSerialSwitchTXChannel </td>
          <td>(</td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>target_level</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">TickType_t&#160;</td>
          <td class="paramname"><em>ticks_to_wait</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Utility function, changing UART TX channel (HID or Serial)</p>
<p>This function changes the gpio pin, which is used to determine where the sent UART data should be used on the USB-companion chip. Either it is directly forwarded to USB-CDC (USB serial) OR it is parsed as USB-HID commands.</p>
<p>To safely change the direction, this function waits for any ongoing transmission and changes the pin afterwards. No waiting if target_level is already activated on GPIO pin.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">target_level</td><td>GPIO target level to check/wait for </td></tr>
    <tr><td class="paramname">ticks_to_wait</td><td>Maximum number of ticks to wait for finishing UART TX </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>ESP_OK if change was fine (or already done before), ESP_FAIL on a timeout </dd></dl>

<p class="definition">Definition at line <a class="el" href="hal__serial_8c_source.html#l00114">114</a> of file <a class="el" href="hal__serial_8c_source.html">hal_serial.c</a>.</p>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="adc58a36fa37939826c6e9b29549b55a6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adc58a36fa37939826c6e9b29549b55a6">&#9670;&nbsp;</a></span>BUF_SIZE_RX</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const int BUF_SIZE_RX = 512</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="hal__serial_8c_source.html#l00069">69</a> of file <a class="el" href="hal__serial_8c_source.html">hal_serial.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="hal__serial_8c_source.html#l00561">halSerialInit()</a>.</p>

</div>
</div>
<a id="a8742cd480180fcaba3079eb3c707bb0e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8742cd480180fcaba3079eb3c707bb0e">&#9670;&nbsp;</a></span>BUF_SIZE_TX</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const int BUF_SIZE_TX = 512</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="hal__serial_8c_source.html#l00089">89</a> of file <a class="el" href="hal__serial_8c_source.html">hal_serial.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="hal__serial_8c_source.html#l00561">halSerialInit()</a>.</p>

</div>
</div>
<a id="ad0911c183882187e70480f1925cc0c55"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad0911c183882187e70480f1925cc0c55">&#9670;&nbsp;</a></span>CMDQUEUE_SIZE</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const int CMDQUEUE_SIZE = 256</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Length of queue for AT commands. </p>
<dl class="section note"><dt>Note</dt><dd>A maximum of CMDQUEUE_SIZE x ATCMD_LENGTH can be allocated (if no task receives the commands) </dd>
<dd>
C# GUI usually floods the input with AT cmds, set at least to 64 to avoid missing AT commands. </dd></dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="hal__serial_8h.html#a57deadb7de70a0230474a4680cc0e2d9" title="Queue for parsed AT commands. ">halSerialATCmds</a> </dd></dl>

<p class="definition">Definition at line <a class="el" href="hal__serial_8c_source.html#l00087">87</a> of file <a class="el" href="hal__serial_8c_source.html">hal_serial.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="hal__serial_8c_source.html#l00561">halSerialInit()</a>.</p>

</div>
</div>
<a id="af2a7c6dc7be333dca54efb59230e5684"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af2a7c6dc7be333dca54efb59230e5684">&#9670;&nbsp;</a></span>hidsendingsem</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">SemaphoreHandle_t hidsendingsem</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Mutex for sending to HID. </p>

<p class="definition">Definition at line <a class="el" href="hal__serial_8c_source.html#l00095">95</a> of file <a class="el" href="hal__serial_8c_source.html">hal_serial.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="hal__serial_8c_source.html#l00551">halSerialHIDFinished()</a>, <a class="el" href="hal__serial_8c_source.html#l00279">halSerialHIDTask()</a>, and <a class="el" href="hal__serial_8c_source.html#l00561">halSerialInit()</a>.</p>

</div>
</div>
<a id="a4ef85c128c2cb518b3771191c8a27e3d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4ef85c128c2cb518b3771191c8a27e3d">&#9670;&nbsp;</a></span>outputcb</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="hal__serial_8h.html#a9645a82bf44ac750418a21920614b3f7">serialoutput_h</a> outputcb = NULL</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Output callback. </p>
<p>If this callback is != NULL, the function halSerialSendUSBSerial will send data to this callback in addition to the serial interface </p><dl class="section see"><dt>See also</dt><dd><a class="el" href="hal__serial_8c.html#af78683f30da18cfc19c2c91006ec6155" title="Send serial bytes to USB-Serial (USB-CDC) ">halSerialSendUSBSerial</a> </dd>
<dd>
<a class="el" href="hal__serial_8h.html#a9645a82bf44ac750418a21920614b3f7" title="Function pointer type for an additional output of a serial stream. ">serialoutput_h</a> </dd></dl>

<p class="definition">Definition at line <a class="el" href="hal__serial_8c_source.html#l00078">78</a> of file <a class="el" href="hal__serial_8c_source.html">hal_serial.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="hal__serial_8c_source.html#l00545">halSerialAddOutputStream()</a>, <a class="el" href="hal__serial_8c_source.html#l00532">halSerialRemoveOutputStream()</a>, and <a class="el" href="hal__serial_8c_source.html#l00441">halSerialSendUSBSerial()</a>.</p>

</div>
</div>
<a id="af8aa2305d1905c876a30e25bf34cc480"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af8aa2305d1905c876a30e25bf34cc480">&#9670;&nbsp;</a></span>serialsendingsem</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">SemaphoreHandle_t serialsendingsem</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Mutex for sending to serial port. </p>

<p class="definition">Definition at line <a class="el" href="hal__serial_8c_source.html#l00093">93</a> of file <a class="el" href="hal__serial_8c_source.html">hal_serial.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="hal__serial_8c_source.html#l00561">halSerialInit()</a>, and <a class="el" href="hal__serial_8c_source.html#l00441">halSerialSendUSBSerial()</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
