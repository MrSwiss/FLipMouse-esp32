<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>FLipMouse/FABI ESP32 firmware: /home/beni/sync/Projects/FH/FLipMouse-esp32/main/flipmouse_fabi_esp32_kbdmouse_main.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">FLipMouse/FABI ESP32 firmware
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_5c982d53a68cdbcd421152b4020263a9.html">main</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">flipmouse_fabi_esp32_kbdmouse_main.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>This is the main entry point of the ESP32 FLipMouse/FABI firmware.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;stdio.h&gt;</code><br />
<code>#include &lt;stdlib.h&gt;</code><br />
<code>#include &lt;string.h&gt;</code><br />
<code>#include &quot;freertos/FreeRTOS.h&quot;</code><br />
<code>#include &quot;freertos/task.h&quot;</code><br />
<code>#include &quot;freertos/event_groups.h&quot;</code><br />
<code>#include &quot;<a class="el" href="task__kbd_8h_source.html">function_tasks/task_kbd.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="task__mouse_8h_source.html">function_tasks/task_mouse.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="task__debouncer_8h_source.html">function_tasks/task_debouncer.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="task__commands_8h_source.html">function_tasks/task_commands.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="task__webgui_8h_source.html">function_tasks/task_webgui.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="hal__adc_8h_source.html">hal/hal_adc.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="hal__io_8h_source.html">hal/hal_io.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="hal__ble_8h_source.html">ble_hid/hal_ble.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="hal__serial_8h_source.html">hal/hal_serial.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="config__switcher_8h_source.html">config_switcher.h</a>&quot;</code><br />
<code>#include &quot;config.h&quot;</code><br />
</div>
<p><a href="flipmouse__fabi__esp32__kbdmouse__main_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a7ce0df38eb467e59f209470c8f5ac4e6"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="flipmouse__fabi__esp32__kbdmouse__main_8c.html#a7ce0df38eb467e59f209470c8f5ac4e6">LOG_TAG</a>&#160;&#160;&#160;&quot;app_main&quot;</td></tr>
<tr class="separator:a7ce0df38eb467e59f209470c8f5ac4e6"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a93e2ea21db142b4c7172565051a18cb1"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="flipmouse__fabi__esp32__kbdmouse__main_8c.html#a93e2ea21db142b4c7172565051a18cb1">switch_radio</a> (void)</td></tr>
<tr class="memdesc:a93e2ea21db142b4c7172565051a18cb1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Switch radio mode.  <a href="#a93e2ea21db142b4c7172565051a18cb1">More...</a><br /></td></tr>
<tr class="separator:a93e2ea21db142b4c7172565051a18cb1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abce06be17fc37d675118a678a8100a36"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="flipmouse__fabi__esp32__kbdmouse__main_8c.html#abce06be17fc37d675118a678a8100a36">app_main</a> ()</td></tr>
<tr class="memdesc:abce06be17fc37d675118a678a8100a36"><td class="mdescLeft">&#160;</td><td class="mdescRight">Main task, created by esp-idf.  <a href="#abce06be17fc37d675118a678a8100a36">More...</a><br /></td></tr>
<tr class="separator:abce06be17fc37d675118a678a8100a36"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a3633668cff0a27ea52ca662673978667"><td class="memItemLeft" align="right" valign="top">EventGroupHandle_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="flipmouse__fabi__esp32__kbdmouse__main_8c.html#a3633668cff0a27ea52ca662673978667">virtualButtonsOut</a> [<a class="el" href="common_8h.html#aee89b7237c851b73f694c2fb1530cbeb">NUMBER_VIRTUALBUTTONS</a>]</td></tr>
<tr class="memdesc:a3633668cff0a27ea52ca662673978667"><td class="mdescLeft">&#160;</td><td class="mdescRight">Event group array for all virtual buttons, used by functional tasks to be triggered.  <a href="#a3633668cff0a27ea52ca662673978667">More...</a><br /></td></tr>
<tr class="separator:a3633668cff0a27ea52ca662673978667"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a591ffaa399081915a0eab951f83f93e2"><td class="memItemLeft" align="right" valign="top">EventGroupHandle_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="flipmouse__fabi__esp32__kbdmouse__main_8c.html#a591ffaa399081915a0eab951f83f93e2">virtualButtonsIn</a> [<a class="el" href="common_8h.html#aee89b7237c851b73f694c2fb1530cbeb">NUMBER_VIRTUALBUTTONS</a>]</td></tr>
<tr class="memdesc:a591ffaa399081915a0eab951f83f93e2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Event group array for all virtual buttons, used by functional tasks to send a signal to the debouncer task.  <a href="#a591ffaa399081915a0eab951f83f93e2">More...</a><br /></td></tr>
<tr class="separator:a591ffaa399081915a0eab951f83f93e2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae2b183880be8976139d636a3a714e315"><td class="memItemLeft" align="right" valign="top">EventGroupHandle_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="flipmouse__fabi__esp32__kbdmouse__main_8c.html#ae2b183880be8976139d636a3a714e315">connectionRoutingStatus</a></td></tr>
<tr class="separator:ae2b183880be8976139d636a3a714e315"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaf12ce68f07ec96638046d2dbe8ffbea"><td class="memItemLeft" align="right" valign="top">SemaphoreHandle_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="flipmouse__fabi__esp32__kbdmouse__main_8c.html#aaf12ce68f07ec96638046d2dbe8ffbea">switchRadioSem</a></td></tr>
<tr class="separator:aaf12ce68f07ec96638046d2dbe8ffbea"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4701c432a28c389e4b8557f2fa3323d1"><td class="memItemLeft" align="right" valign="top">QueueHandle_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="flipmouse__fabi__esp32__kbdmouse__main_8c.html#a4701c432a28c389e4b8557f2fa3323d1">config_switcher</a></td></tr>
<tr class="memdesc:a4701c432a28c389e4b8557f2fa3323d1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Queue to receive config changing commands.  <a href="#a4701c432a28c389e4b8557f2fa3323d1">More...</a><br /></td></tr>
<tr class="separator:a4701c432a28c389e4b8557f2fa3323d1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a841902610ed5a9d5ee171749a85a8b8c"><td class="memItemLeft" align="right" valign="top">QueueHandle_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="flipmouse__fabi__esp32__kbdmouse__main_8c.html#a841902610ed5a9d5ee171749a85a8b8c">hid_usb</a></td></tr>
<tr class="memdesc:a841902610ed5a9d5ee171749a85a8b8c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Queue for sending HID commands to USB.  <a href="#a841902610ed5a9d5ee171749a85a8b8c">More...</a><br /></td></tr>
<tr class="separator:a841902610ed5a9d5ee171749a85a8b8c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4d504fcad8a2fb54bd8af573af7d4834"><td class="memItemLeft" align="right" valign="top">QueueHandle_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="flipmouse__fabi__esp32__kbdmouse__main_8c.html#a4d504fcad8a2fb54bd8af573af7d4834">hid_ble</a></td></tr>
<tr class="memdesc:a4d504fcad8a2fb54bd8af573af7d4834"><td class="mdescLeft">&#160;</td><td class="mdescRight">Queue for sending mouse reports.  <a href="#a4d504fcad8a2fb54bd8af573af7d4834">More...</a><br /></td></tr>
<tr class="separator:a4d504fcad8a2fb54bd8af573af7d4834"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af5f9c13fa0128514696997d6dd9694f2"><td class="memItemLeft" align="right" valign="top"><a class="el" href="common_8h.html#ab6afacea6a7310707d47839506c30a73">radio_status_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="flipmouse__fabi__esp32__kbdmouse__main_8c.html#af5f9c13fa0128514696997d6dd9694f2">radio</a> = <a class="el" href="common_8h.html#ab6afacea6a7310707d47839506c30a73af096820742c38363e9d6c33e7c932780">UNINITIALIZED</a></td></tr>
<tr class="memdesc:af5f9c13fa0128514696997d6dd9694f2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Currently active radio state.  <a href="#af5f9c13fa0128514696997d6dd9694f2">More...</a><br /></td></tr>
<tr class="separator:af5f9c13fa0128514696997d6dd9694f2"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>This is the main entry point of the ESP32 FLipMouse/FABI firmware. </p>
<p>In this file, the app_main function is called by the esp-idf. This function initializes all necessary RTOS services &amp; objects, starts necessary tasks and exits afterwards.</p>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="flipmouse__fabi__esp32__kbdmouse__main_8c.html#abce06be17fc37d675118a678a8100a36" title="Main task, created by esp-idf. ">app_main</a> </dd></dl>

<p class="definition">Definition in file <a class="el" href="flipmouse__fabi__esp32__kbdmouse__main_8c_source.html">flipmouse_fabi_esp32_kbdmouse_main.c</a>.</p>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a id="a7ce0df38eb467e59f209470c8f5ac4e6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7ce0df38eb467e59f209470c8f5ac4e6">&#9670;&nbsp;</a></span>LOG_TAG</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LOG_TAG&#160;&#160;&#160;&quot;app_main&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="flipmouse__fabi__esp32__kbdmouse__main_8c_source.html#l00053">53</a> of file <a class="el" href="flipmouse__fabi__esp32__kbdmouse__main_8c_source.html">flipmouse_fabi_esp32_kbdmouse_main.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="flipmouse__fabi__esp32__kbdmouse__main_8c_source.html#l00091">app_main()</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="abce06be17fc37d675118a678a8100a36"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abce06be17fc37d675118a678a8100a36">&#9670;&nbsp;</a></span>app_main()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void app_main </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Main task, created by esp-idf. </p>
<p>This task is used to initialize all queues &amp; flags. In addition, all necessary tasks are created After initialisation, this task deletes itself. </p>

<p class="definition">Definition at line <a class="el" href="flipmouse__fabi__esp32__kbdmouse__main_8c_source.html#l00091">91</a> of file <a class="el" href="flipmouse__fabi__esp32__kbdmouse__main_8c_source.html">flipmouse_fabi_esp32_kbdmouse_main.c</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="flipmouse__fabi__esp32__kbdmouse__main_8c_abce06be17fc37d675118a678a8100a36_cgraph.png" border="0" usemap="#flipmouse__fabi__esp32__kbdmouse__main_8c_abce06be17fc37d675118a678a8100a36_cgraph" alt=""/></div>
<map name="flipmouse__fabi__esp32__kbdmouse__main_8c_abce06be17fc37d675118a678a8100a36_cgraph" id="flipmouse__fabi__esp32__kbdmouse__main_8c_abce06be17fc37d675118a678a8100a36_cgraph">
<area shape="rect" id="node2" href="task__debouncer_8c.html#a79d88e490be7198b9cc37556c66b837b" title="Debouncing main task. " alt="" coords="166,87,281,113"/>
<area shape="rect" id="node8" href="hal__adc_8c.html#a6f0d302f35e5b7f7a1144f0ddace35d2" title="Init the ADC driver module. " alt="" coords="410,517,490,544"/>
<area shape="rect" id="node9" href="hal__adc_8c.html#ae549c157d94729e8b06cb391f0f2c97b" title="Calibration function. " alt="" coords="837,568,951,595"/>
<area shape="rect" id="node14" href="hal__io_8c.html#aa5ee74913a09cba6dca62bfdc9f8342b" title="Initializing IO HAL. " alt="" coords="415,315,485,341"/>
<area shape="rect" id="node19" href="config__switcher_8c.html#aafed047c8d04b814a85239e031cbad7b" title="Initializing the config switching functionality. " alt="" coords="160,985,287,1012"/>
<area shape="rect" id="node32" href="hal__ble_8h.html#a559e9af2167a8f1b05a8304234418ed3" title="Main init function to start HID interface (C interface) " alt="" coords="182,1531,265,1557"/>
<area shape="rect" id="node35" href="hal__serial_8c.html#a2d03c06463b09e33d87d90eb273819b0" title="Initialize the serial HAL. " alt="" coords="178,1581,269,1608"/>
<area shape="rect" id="node38" href="task__commands_8c.html#aedb896e40753227f80768e09d3748419" title="Init the command parser. " alt="" coords="157,1632,289,1659"/>
<area shape="rect" id="node40" href="task__webgui_8c.html#a669b9245d5040c0162481f7b24dbeea7" title="Init the web / DNS server and the web gui. " alt="" coords="165,1277,281,1304"/>
<area shape="rect" id="node45" href="task__webgui_8c.html#af4fe29c8fc1fde365cdb8344cb402156" title="En&#45; or Disable WiFi interface. " alt="" coords="599,1404,758,1431"/>
<area shape="rect" id="node48" href="hal__ble_8h.html#a1ade7df97a34fa89e0f2db7f5d2614de" title="En&#45; or Disable BLE interface. " alt="" coords="617,1480,741,1507"/>
<area shape="rect" id="node49" href="hal__io_8c.html#a645ccf6a4abeccd8639c66f11138af4a" title="Add long press handler for Wifi button. " alt="" coords="132,1683,315,1709"/>
<area shape="rect" id="node50" href="flipmouse__fabi__esp32__kbdmouse__main_8c.html#a93e2ea21db142b4c7172565051a18cb1" title="Switch radio mode. " alt="" coords="176,1733,271,1760"/>
<area shape="rect" id="node3" href="config__switcher_8c.html#a921538bec34d128a44a748fd5a2c391f" title="Get the current config struct. " alt="" coords="833,151,955,177"/>
<area shape="rect" id="node4" href="task__debouncer_8c.html#a308ec03f3a777bacc9507657f285159a" title="Look for a possibly running debouncing timer. " alt="" coords="828,75,960,101"/>
<area shape="rect" id="node5" href="task__debouncer_8c.html#a2d41ed2a246a1b8d4ee5510262001e50" title="Start a debouncing timer with given debounce time and VB number. " alt="" coords="409,87,491,113"/>
<area shape="rect" id="node7" href="task__debouncer_8c.html#ad6a8419e00b94feeb5177a3570efe6ba" title="Cancel a possibly running debouncing timer. " alt="" coords="847,5,941,32"/>
<area shape="rect" id="node6" href="task__debouncer_8c.html#a4a76abdbb849aa0bbc66aa001c6f4af9" title="Timer callback for debouncing. " alt="" coords="612,87,745,113"/>
<area shape="rect" id="node11" href="hal__adc_8c.html#aa8d7ae84ad54c532e5cefccc8c3cf59e" title="halAdcStrongTimeout" alt="" coords="605,492,752,519"/>
<area shape="rect" id="node12" href="hal__adc_8c.html#a4135bb73c2271b4a27db8d8d81884de7" title="Reload ADC config. " alt="" coords="607,441,750,468"/>
<area shape="rect" id="node10" href="hal__adc_8c.html#a5e0d74baf098e774b0e3aa0dab621987" title="Read out analog voltages, apply sensor gain and deadzone. " alt="" coords="1016,524,1137,551"/>
<area shape="rect" id="node13" href="hal__adc_8c.html#aee719704e643d27c1faab768cf4bc22e" title="HAL TASK &#45; Threshold task for ADC. " alt="" coords="820,479,968,505"/>
<area shape="rect" id="node15" href="hal__io_8c.html#addfc4a2f0cb7848979817346b6f53afc" title="GPIO ISR handler for buttons (internal/external) " alt="" coords="621,340,737,367"/>
<area shape="rect" id="node16" href="hal__io_8c.html#a410f1d9b7e6031b9e626af17fba411d1" title="Timer callback for calling longpress handler. " alt="" coords="610,391,747,417"/>
<area shape="rect" id="node17" href="hal__io_8c.html#af049ec6b187a1b5b1575120758561ae8" title="HAL TASK &#45; IR receiving (recording) task. " alt="" coords="615,289,742,316"/>
<area shape="rect" id="node18" href="hal__io_8c.html#a5c30b3b4a88e8f23489485659d53c7c0" title="HAL TASK &#45; Buzzer update task. " alt="" coords="617,188,740,215"/>
<area shape="rect" id="node20" href="config__switcher_8c.html#af5af5079d1982d42e165039e6de7e40a" title="CONTINOUS TASK &#45; Config switcher task, internal config reloading. " alt="" coords="381,897,519,924"/>
<area shape="rect" id="node21" href="hal__storage_8c.html#aead99606f84645b2bb6ae000461bf819" title="Start a storage transaction. " alt="" coords="589,1100,769,1127"/>
<area shape="rect" id="node22" href="hal__storage_8c.html#aad5b764e7c611ff24dbcdd872dc9ae76" title="Load a slot by an action. " alt="" coords="623,1049,735,1076"/>
<area shape="rect" id="node23" href="hal__storage_8c.html#a8abf9a5b8727dc8d7cbe76ba0e2dcb6b" title="Delete one or all slots. " alt="" coords="606,695,751,721"/>
<area shape="rect" id="node24" href="hal__storage_8c.html#a00b5db14e24d7ada8a42aa6b3f1a1cb7" title="Finish a storage transaction. " alt="" coords="585,1252,772,1279"/>
<area shape="rect" id="node25" href="hal__storage_8c.html#a75596c64adaa2b8d9104530acc94b094" title="Load a slot by a slot name. " alt="" coords="605,745,752,772"/>
<area shape="rect" id="node26" href="task__mouse_8c.html#aa8f5c0436e569589e735c419fc3d0ed8" title="FUNCTIONAL TASK &#45; Trigger mouse action. " alt="" coords="632,796,725,823"/>
<area shape="rect" id="node27" href="task__macros_8c.html#a7acda2dcac23ebfffade8a15b40d219f" title="FUNCTIONAL TASK &#45; Macro execution. " alt="" coords="633,847,724,873"/>
<area shape="rect" id="node28" href="task__kbd_8c.html#a8ff4618047a049178bfb1d60abfefb5d" title="FUNCTIONAL TASK &#45; trigger keyboard actions. " alt="" coords="625,897,732,924"/>
<area shape="rect" id="node29" href="task__joystick_8c.html#a3040132b9cef8e73060fcd9c17dc116b" title="FUNCTIONAL TASK &#45; Trigger joystick action. " alt="" coords="629,948,728,975"/>
<area shape="rect" id="node30" href="config__switcher_8c.html#a083adf41746c3380dcc6dbc099047f2e" title="FUNCTIONAL TASK &#45; Load another slot. " alt="" coords="609,999,748,1025"/>
<area shape="rect" id="node31" href="hal__adc_8c.html#a3217185bc86562dee8617ded3872022f" title="FUNCTIONAL TASK &#45; Trigger zero&#45;point calibration of mouthpiece. " alt="" coords="622,644,735,671"/>
<area shape="rect" id="node33" href="classTask.html#afe0f5594c56b8cc7ac96c2198d5d81b4" title="Set the stack size of the task. " alt="" coords="381,1581,519,1608"/>
<area shape="rect" id="node34" href="classTask.html#a6f13d13787e21dc929b61d112b863433" title="Start an instance of the task. " alt="" coords="407,1531,493,1557"/>
<area shape="rect" id="node36" href="hal__serial_8c.html#a6689f99c3a8e5f787a3d995260d8d298" title="CONTINOUS TASK &#45; Process HID commands &amp; send via HID wire to LPC. " alt="" coords="387,1683,513,1709"/>
<area shape="rect" id="node37" href="hal__serial_8c.html#ab3a538fb88a9732f0afc0188cc3c9c38" title="UART RX task for AT command pattern detection and parsing. " alt="" coords="390,1632,510,1659"/>
<area shape="rect" id="node39" href="task__commands_8c.html#a7b36c39275d773aaedcb327ef4e1516f" title="task_commands" alt="" coords="391,1733,509,1760"/>
<area shape="rect" id="node41" href="hal__storage_8c.html#a63ec8e05a2bb4c214600e94b8ab05eea" title="Load a string from NVS (global, no slot assignment) " alt="" coords="363,1328,537,1355"/>
<area shape="rect" id="node42" href="task__webgui_8c.html#a11dd6a5edc46c297b26382ebce3c34cb" title="Event handler for wifi status updates. " alt="" coords="385,1176,515,1203"/>
<area shape="rect" id="node43" href="captdns_8c.html#a82f468eb219b14b853eb183149894e92" title="captdnsInit" alt="" coords="407,1227,493,1253"/>
<area shape="rect" id="node44" href="task__webgui_8c.html#ae5ad2f76f20781fd8c89e542bcc8a551" title="Timer callback for disabling wifi. " alt="" coords="401,1429,499,1456"/>
<area shape="rect" id="node46" href="task__webgui_8c.html#adcc5b062c057f73762b1f19b2f6a8185" title="CONTINOUS TASK &#45; Main webserver task. " alt="" coords="851,1429,937,1456"/>
<area shape="rect" id="node47" href="task__webgui_8c.html#a5f462e5b8bd4803c256bf22a004eacde" title="CONTINOUS TASK &#45; Websocket server task. " alt="" coords="853,1379,935,1405"/>
</map>
</div>

</div>
</div>
<a id="a93e2ea21db142b4c7172565051a18cb1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a93e2ea21db142b4c7172565051a18cb1">&#9670;&nbsp;</a></span>switch_radio()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void switch_radio </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Switch radio mode. </p>
<p>This method is used to switch between the radio modes (radio_status_t). It will be called via the IO long press handler. Modes are currently switched in following order (wrap around):</p><ul>
<li>BLE</li>
<li>BLE_PAIRING</li>
<li>WIFI</li>
</ul>
<p>Actual switching is done in app_main, mostly because this method is executed in timer task context, with limited stack.</p>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="hal__io_8h.html#a645ccf6a4abeccd8639c66f11138af4a" title="Add long press handler for Wifi button. ">halIOAddLongPressHandler</a> </dd>
<dd>
<a class="el" href="hal__io_8h.html#a7501b46689ced3389164f900567a5025" title="Timeout ([ms]) for triggering long press action handler. ">HAL_IO_LONGACTION_TIMEOUT</a> </dd></dl>

<p class="definition">Definition at line <a class="el" href="flipmouse__fabi__esp32__kbdmouse__main_8c_source.html#l00080">80</a> of file <a class="el" href="flipmouse__fabi__esp32__kbdmouse__main_8c_source.html">flipmouse_fabi_esp32_kbdmouse_main.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="flipmouse__fabi__esp32__kbdmouse__main_8c_source.html#l00091">app_main()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="flipmouse__fabi__esp32__kbdmouse__main_8c_a93e2ea21db142b4c7172565051a18cb1_icgraph.png" border="0" usemap="#flipmouse__fabi__esp32__kbdmouse__main_8c_a93e2ea21db142b4c7172565051a18cb1_icgraph" alt=""/></div>
<map name="flipmouse__fabi__esp32__kbdmouse__main_8c_a93e2ea21db142b4c7172565051a18cb1_icgraph" id="flipmouse__fabi__esp32__kbdmouse__main_8c_a93e2ea21db142b4c7172565051a18cb1_icgraph">
<area shape="rect" id="node2" href="flipmouse__fabi__esp32__kbdmouse__main_8c.html#abce06be17fc37d675118a678a8100a36" title="Main task, created by esp&#45;idf. " alt="" coords="148,5,227,32"/>
</map>
</div>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="a4701c432a28c389e4b8557f2fa3323d1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4701c432a28c389e4b8557f2fa3323d1">&#9670;&nbsp;</a></span>config_switcher</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">QueueHandle_t config_switcher</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Queue to receive config changing commands. </p>
<p>A string is passed to this queue with a maximum length of SLOTNAME_LENGTH.</p>
<p>Either a special command is passed or the slotname which should be loaded. Possible strings to send to this queue:</p><ul>
<li>Name of the slot to be loaded</li>
<li>"__NEXT" for next slot</li>
<li>"__PREVIOUS" for previous slot</li>
<li>"__DEFAULT" for default slot</li>
<li>"__RESTOREFACTORY" to delete all slots &amp; reset default slot to factory defaults</li>
<li>"__UPDATE" to reload tasks based on currentConfig. Used to update the configuration when changed by configuration software/GUI.</li>
</ul>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="common_8h.html#ab05a6082c57cf5ad37e922cbfde77a88">SLOTNAME_LENGTH</a> </dd>
<dd>
<a class="el" href="config__switcher_8c.html#af5af5079d1982d42e165039e6de7e40a" title="CONTINOUS TASK - Config switcher task, internal config reloading. ">configSwitcherTask</a> </dd>
<dd>
currentConfig </dd></dl>

<p class="definition">Definition at line <a class="el" href="flipmouse__fabi__esp32__kbdmouse__main_8c_source.html#l00059">59</a> of file <a class="el" href="flipmouse__fabi__esp32__kbdmouse__main_8c_source.html">flipmouse_fabi_esp32_kbdmouse_main.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="flipmouse__fabi__esp32__kbdmouse__main_8c_source.html#l00091">app_main()</a>, <a class="el" href="task__commands_8c_source.html#l00127">checkqueues()</a>, <a class="el" href="config__switcher_8c_source.html#l00612">configSwitcherInit()</a>, <a class="el" href="config__switcher_8c_source.html#l00300">configSwitcherTask()</a>, <a class="el" href="config__switcher_8c_source.html#l00160">configTriggerUpdate()</a>, and <a class="el" href="config__switcher_8c_source.html#l00545">task_configswitcher()</a>.</p>

</div>
</div>
<a id="ae2b183880be8976139d636a3a714e315"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae2b183880be8976139d636a3a714e315">&#9670;&nbsp;</a></span>connectionRoutingStatus</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">EventGroupHandle_t connectionRoutingStatus</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>this flag group is used to determine the routing of different data to either USB, BLE or both. In addition this flag group contains status information (1&lt;&lt;7) should send data to USB HID? (1&lt;&lt;6) should send data to BLE HID? (1&lt;&lt;5) is the FLipMouse in CIM mode? (1&lt;&lt;4) is the wifi active? (1&lt;&lt;3) is a client connected to wifi?</p>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="common_8h.html#a9f5db9a2d9f33eb7e1b8e82ca2dffe81">DATATO_USB</a> </dd>
<dd>
<a class="el" href="common_8h.html#a23e20bbc7b5cb196155927ffb1375bed">DATATO_BLE</a> </dd>
<dd>
<a class="el" href="common_8h.html#a02e5596203592d0277b6c4a4f5755820">DATATO_CIM</a> </dd>
<dd>
<a class="el" href="common_8h.html#af11bf2c47cd0354ecfee72f9c88a4e2d">WIFI_ACTIVE</a> </dd>
<dd>
<a class="el" href="common_8h.html#a9d086131b0622a8aaeb0db9b1ccbe725">WIFI_CLIENT_CONNECTED</a> </dd></dl>

<p class="definition">Definition at line <a class="el" href="flipmouse__fabi__esp32__kbdmouse__main_8c_source.html#l00057">57</a> of file <a class="el" href="flipmouse__fabi__esp32__kbdmouse__main_8c_source.html">flipmouse_fabi_esp32_kbdmouse_main.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="flipmouse__fabi__esp32__kbdmouse__main_8c_source.html#l00091">app_main()</a>, <a class="el" href="config__switcher_8c_source.html#l00215">configUpdate()</a>, <a class="el" href="hal__adc_8c_source.html#l00364">halAdcProcessPressure()</a>, <a class="el" href="task__kbd_8c_source.html#l00144">sendKbd()</a>, <a class="el" href="task__joystick_8c_source.html#l00123">task_joystick()</a>, <a class="el" href="task__mouse_8c_source.html#l00079">task_mouse()</a>, <a class="el" href="task__webgui_8c_source.html#l00459">taskWebGUIEnDisable()</a>, <a class="el" href="task__webgui_8c_source.html#l00569">taskWebGUIInit()</a>, and <a class="el" href="task__webgui_8c_source.html#l00388">wifi_event_handler()</a>.</p>

</div>
</div>
<a id="a4d504fcad8a2fb54bd8af573af7d4834"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4d504fcad8a2fb54bd8af573af7d4834">&#9670;&nbsp;</a></span>hid_ble</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">QueueHandle_t hid_ble</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Queue for sending mouse reports. </p>
<p>Queue for sending HID commands to BLE.</p>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="common_8h.html#a4f29037853f9d7a11aeb531c16986103">mouse_command_t</a> </dd></dl>

<p class="definition">Definition at line <a class="el" href="flipmouse__fabi__esp32__kbdmouse__main_8c_source.html#l00061">61</a> of file <a class="el" href="flipmouse__fabi__esp32__kbdmouse__main_8c_source.html">flipmouse_fabi_esp32_kbdmouse_main.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="flipmouse__fabi__esp32__kbdmouse__main_8c_source.html#l00091">app_main()</a>, <a class="el" href="task__commands_8c_source.html#l00127">checkqueues()</a>, <a class="el" href="hal__adc_8c_source.html#l01095">halAdcInit()</a>, <a class="el" href="hal__adc_8c_source.html#l00364">halAdcProcessPressure()</a>, <a class="el" href="task__kbd_8c_source.html#l00144">sendKbd()</a>, <a class="el" href="task__joystick_8c_source.html#l00123">task_joystick()</a>, and <a class="el" href="task__mouse_8c_source.html#l00079">task_mouse()</a>.</p>

</div>
</div>
<a id="a841902610ed5a9d5ee171749a85a8b8c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a841902610ed5a9d5ee171749a85a8b8c">&#9670;&nbsp;</a></span>hid_usb</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">QueueHandle_t hid_usb</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Queue for sending HID commands to USB. </p>
<p>NOTE: keyboard queues receive uint16 data type, which is either directly used as keycode by either HID or serial task (if high byte is != 0) OR parsed by keyboard helper functions. In this case multibyte text (unicode) should use only low byte for each byte of the input text </p>

<p class="definition">Definition at line <a class="el" href="flipmouse__fabi__esp32__kbdmouse__main_8c_source.html#l00060">60</a> of file <a class="el" href="flipmouse__fabi__esp32__kbdmouse__main_8c_source.html">flipmouse_fabi_esp32_kbdmouse_main.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="flipmouse__fabi__esp32__kbdmouse__main_8c_source.html#l00091">app_main()</a>, <a class="el" href="task__commands_8c_source.html#l00127">checkqueues()</a>, <a class="el" href="hal__adc_8c_source.html#l01095">halAdcInit()</a>, <a class="el" href="hal__adc_8c_source.html#l00364">halAdcProcessPressure()</a>, <a class="el" href="hal__io_8c_source.html#l00383">halIOLEDTask()</a>, <a class="el" href="hal__serial_8c_source.html#l00273">halSerialHIDTask()</a>, <a class="el" href="hal__serial_8c_source.html#l00482">halSerialReset()</a>, <a class="el" href="task__kbd_8c_source.html#l00144">sendKbd()</a>, <a class="el" href="task__joystick_8c_source.html#l00123">task_joystick()</a>, and <a class="el" href="task__mouse_8c_source.html#l00079">task_mouse()</a>.</p>

</div>
</div>
<a id="af5f9c13fa0128514696997d6dd9694f2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af5f9c13fa0128514696997d6dd9694f2">&#9670;&nbsp;</a></span>radio</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="common_8h.html#ab6afacea6a7310707d47839506c30a73">radio_status_t</a> radio = <a class="el" href="common_8h.html#ab6afacea6a7310707d47839506c30a73af096820742c38363e9d6c33e7c932780">UNINITIALIZED</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Currently active radio state. </p>

<p class="definition">Definition at line <a class="el" href="flipmouse__fabi__esp32__kbdmouse__main_8c_source.html#l00063">63</a> of file <a class="el" href="flipmouse__fabi__esp32__kbdmouse__main_8c_source.html">flipmouse_fabi_esp32_kbdmouse_main.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="flipmouse__fabi__esp32__kbdmouse__main_8c_source.html#l00091">app_main()</a>.</p>

</div>
</div>
<a id="aaf12ce68f07ec96638046d2dbe8ffbea"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aaf12ce68f07ec96638046d2dbe8ffbea">&#9670;&nbsp;</a></span>switchRadioSem</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">SemaphoreHandle_t switchRadioSem</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="flipmouse__fabi__esp32__kbdmouse__main_8c_source.html#l00058">58</a> of file <a class="el" href="flipmouse__fabi__esp32__kbdmouse__main_8c_source.html">flipmouse_fabi_esp32_kbdmouse_main.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="flipmouse__fabi__esp32__kbdmouse__main_8c_source.html#l00091">app_main()</a>, and <a class="el" href="flipmouse__fabi__esp32__kbdmouse__main_8c_source.html#l00080">switch_radio()</a>.</p>

</div>
</div>
<a id="a591ffaa399081915a0eab951f83f93e2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a591ffaa399081915a0eab951f83f93e2">&#9670;&nbsp;</a></span>virtualButtonsIn</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">EventGroupHandle_t virtualButtonsIn[<a class="el" href="common_8h.html#aee89b7237c851b73f694c2fb1530cbeb">NUMBER_VIRTUALBUTTONS</a>]</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Event group array for all virtual buttons, used by functional tasks to send a signal to the debouncer task. </p>
<p>Equal to virtualButtonsOut, only these flags should be used to invoke the debouncer. If one of these flags will be set, this flag will be set in virtualButtonsOut as well (by the debouncer). If this flag is cleared within the debouncing time, the flag will not be mapped to virtualButtonsOut.</p>
<p>VB setting tasks should use this eventgroup if the debouncer should be invoked. If no debouncing is necessary, write directly to virtualButtonsOut</p>
<dl class="section warning"><dt>Warning</dt><dd>VB pending tasks should always pend for virtualButtonsOut. </dd></dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="common_8h.html#a3633668cff0a27ea52ca662673978667" title="Event group array for all virtual buttons, used by functional tasks to be triggered. ">virtualButtonsOut</a> </dd></dl>

<p class="definition">Definition at line <a class="el" href="flipmouse__fabi__esp32__kbdmouse__main_8c_source.html#l00056">56</a> of file <a class="el" href="flipmouse__fabi__esp32__kbdmouse__main_8c_source.html">flipmouse_fabi_esp32_kbdmouse_main.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="flipmouse__fabi__esp32__kbdmouse__main_8c_source.html#l00091">app_main()</a>, <a class="el" href="task__debouncer_8c_source.html#l00180">debouncerCallback()</a>, <a class="el" href="hal__io_8c_source.html#l00127">gpio_isr_handler()</a>, <a class="el" href="hal__adc_8c_source.html#l01095">halAdcInit()</a>, <a class="el" href="hal__adc_8c_source.html#l00132">halAdcProcessStrongMode()</a>, <a class="el" href="hal__adc_8c_source.html#l00865">halAdcTaskThreshold()</a>, and <a class="el" href="task__debouncer_8c_source.html#l00305">task_debouncer()</a>.</p>

</div>
</div>
<a id="a3633668cff0a27ea52ca662673978667"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3633668cff0a27ea52ca662673978667">&#9670;&nbsp;</a></span>virtualButtonsOut</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">EventGroupHandle_t virtualButtonsOut[<a class="el" href="common_8h.html#aee89b7237c851b73f694c2fb1530cbeb">NUMBER_VIRTUALBUTTONS</a>]</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Event group array for all virtual buttons, used by functional tasks to be triggered. </p>
<p>Each EventGroupHandle contains 4 virtual buttons (VB), press and release actions are included: (1&lt;&lt;0) press action of VB 0 (or 4, 8, 12, 16, 20, 24, 28, depending on array index) (1&lt;&lt;1) press action of VB 1 (or 5, 9, 13, 17, 21, 25, 29, depending on array index) (1&lt;&lt;2) press action of VB 2 (or 6, 10, 14, 18, 22, 26, 30, depending on array index) (1&lt;&lt;3) press action of VB 3 (or 7, 11, 15, 19, 23, 27, 31, depending on array index) The same for release actions: (1&lt;&lt;4) release for VB 0 (+ the others) (1&lt;&lt;5) release for VB 1 (+ the others) (1&lt;&lt;6) release for VB 2 (+ the others) (1&lt;&lt;7) release for VB 3 (+ the others)</p>
<p>Each functional task should pend on these flags, which will be set by the hal task or the analog task. Please reset the flag after pending. Unused flags can be left set, on a task change for a virtual button, these flags are reset.</p>
<dl class="section warning"><dt>Warning</dt><dd>If you want to debounce an action, set the corresponding flag in virtualButtonsIn </dd></dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="common_8h.html#a591ffaa399081915a0eab951f83f93e2" title="Event group array for all virtual buttons, used by functional tasks to send a signal to the debouncer...">virtualButtonsIn</a> </dd></dl>

<p class="definition">Definition at line <a class="el" href="flipmouse__fabi__esp32__kbdmouse__main_8c_source.html#l00055">55</a> of file <a class="el" href="flipmouse__fabi__esp32__kbdmouse__main_8c_source.html">flipmouse_fabi_esp32_kbdmouse_main.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="flipmouse__fabi__esp32__kbdmouse__main_8c_source.html#l00091">app_main()</a>, <a class="el" href="task__debouncer_8c_source.html#l00180">debouncerCallback()</a>, <a class="el" href="hal__adc_8c_source.html#l01095">halAdcInit()</a>, <a class="el" href="hal__adc_8c_source.html#l00796">task_calibration()</a>, <a class="el" href="config__switcher_8c_source.html#l00545">task_configswitcher()</a>, <a class="el" href="task__debouncer_8c_source.html#l00305">task_debouncer()</a>, <a class="el" href="task__infrared_8c_source.html#l00051">task_infrared()</a>, <a class="el" href="task__joystick_8c_source.html#l00123">task_joystick()</a>, <a class="el" href="task__kbd_8c_source.html#l00164">task_keyboard()</a>, <a class="el" href="task__macros_8c_source.html#l00050">task_macro()</a>, and <a class="el" href="task__mouse_8c_source.html#l00079">task_mouse()</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
