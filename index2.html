<html>
<head>
    <title>FlipMouse WebGUI</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="css/normalize.css">
    <link rel="stylesheet" href="css/skeleton.css">
    <link rel="stylesheet" href="css/tabby.min.css">
    <link rel="stylesheet" href="css/custom.css">
    <script src="lib/lquery.js"></script>
    <script src="lib/areCommunicatorLight.js"></script>
    <script src="lib/flipMouseCommunicator.js"></script>
    <script src="lib/tabby.min.js"></script>
    <script src="lib/dom-i18n.min.js"></script>
</head>
<body>
<div id="content">
    <h1 data-translatable>FLipMouse Web Configuration // FLipMouse Webkonfiguration</h1>

    <div data-tabs class="row">
        <div class="four columns"><a class="button button-primary" data-tab href="#tabBasic" class="ui-btn-active" data-translatable>Basic Setup // Basiskonfiguration</a></div>
        <div class="four columns"><a class="button button-primary" data-tab href="#tabPuff">Sip and Puff</a></div>
        <div class="four columns"><a class="button button-primary" data-tab href="#tabActions">Learn Actions</a></div>
    </div>
    <div data-tabs-content>
        <div data-tabs-pane class="tabs-pane" id="tabBasic">
            <label for="SENSITIVITY_X" data-translatable>Horizontal Sensitivity: // Sensitivität horizontal:</label>
            <div class="row">
                <span id="SENSITIVITY_X_VAL" class="text-center one column">0</span>
                <input type="range" oninput="sliderChanged(event)" onchange="sliderChanged(event)" id="SENSITIVITY_X" min="0" max="100" class="eleven columns">
            </div>
            <label for="SENSITIVITY_Y" data-translatable>Vertical Sensitivity: // Sensitivität vertikal:</label>
            <div class="row">
                <span id="SENSITIVITY_Y_VAL" class="text-center one column">0</span>
                <input type="range" oninput="sliderChanged(event)" onchange="sliderChanged(event)" id="SENSITIVITY_Y" min="0" max="100" class="eleven columns">
            </div>

            <br/>
            <label for="DEADZONE_X">Horizontal Deadzone:</label>
            <div class="row">
                <span id="DEADZONE_X_VAL" class="text-center one column">0</span>
                <input type="range" oninput="sliderChanged(event)" onchange="sliderChanged(event)" id="DEADZONE_X" min="0" max="100" class="eleven columns">
            </div>
            <label for="DEADZONE_Y">Vertical Deadzone:</label>
            <div class="row">
                <span id="DEADZONE_Y_VAL" class="text-center one column">0</span>
                <input type="range" oninput="sliderChanged(event)" onchange="sliderChanged(event)" id="DEADZONE_Y" min="0" max="100" class="eleven columns">
            </div>

            <br/>
            <br/>
            <div class="row">
                <button id="basic-button" onclick="save()" class="one-third">
                    <div id="basic-button-normal" data-translatable>Save // Speichern</div>
                    <div id="basic-button-saving" style="display: none;" data-translatable>Saving... // Wird gespeichert...</div>
                </button>
            </div>
        </div>
        <div data-tabs-pane class="tabs-pane" id="tabPuff">

            <div id="tab-puff-container" class="relative">

                <div class="row back-layer full-height full-width">
                    <div class="two columns"><span style="font-size: 1px; color: transparent">_</span></div>
                    <div class="ten columns full-height relative">
                        <div id="guide-max" class="back-layer full-height border-right-red" style="width: 50%;"></div>
                        <div id="guide-min" class="back-layer full-height border-right-blue" style="width: 50%;"></div>
                        <div id="guide-current" class="back-layer full-height border-right-gray" style="width: 50%;"></div>
                    </div>
                </div>

                <br/>
                <label for="SIP_THRESHOLD" data-translatable>Sip Threshold: // Schwellenwert Saugen:</label>
                <div class="row">
                    <span id="SIP_THRESHOLD_VAL" class="text-center two columns">0</span>
                    <input type="range" oninput="sliderChanged(event)" onchange="sliderChanged(event)" id="SIP_THRESHOLD" min="0" max="1023" class="ten columns"/>
                </div>
                <label for="SIP_STRONG_THRESHOLD" data-translatable>Strong Sip Threshold: // Schwellenwert Saugen stark:</label>
                <div class="row">
                    <span id="SIP_STRONG_THRESHOLD_VAL" class="text-center two columns">0</span>
                    <input type="range" oninput="sliderChanged(event)" onchange="sliderChanged(event)" id="SIP_STRONG_THRESHOLD" min="0" max="1023" class="ten columns"/>
                </div>

                <br/>
                <label for="value-bar-wrapper" data-translatable>Live values: // Aktuelle Werte:</label>
                <div class="row">
                    <div id="value-bar-wrapper" class="text-center two columns">
                        <span data-translatable>current: // aktuell:</span>
                        <span id="currentValue">0</span>,
                        <span>max:</span>
                        <span id="maxValue">0</span>,
                        <span>min:</span>
                        <span id="minValue">-1</span></div>
                    <div class="ten columns" style="border-style: solid; border-width: thin; background-color: transparent">
                        <div id="value-bar" style="width: 50%;"></div>
                    </div>
                </div>

                <br/>
                <br/>
                <label for="PUFF_THRESHOLD" data-translatable>Puff Threshold: // Schwellenwert Blasen:</label>
                <div class="row">
                    <span id="PUFF_THRESHOLD_VAL" class="text-center two columns">0</span>
                    <input type="range" oninput="sliderChanged(event)" onchange="sliderChanged(event)" id="PUFF_THRESHOLD" min="0" max="1023" class="ten columns">
                </div>
                <label for="PUFF_STRONG_THRESHOLD" data-translatable>Strong Puff Threshold: // Schwellenwert Blasen stark:</label>
                <div class="row">
                    <span id="PUFF_STRONG_THRESHOLD_VAL" class="text-center two columns">0</span>
                    <input type="range" oninput="sliderChanged(event)" onchange="sliderChanged(event)" id="PUFF_STRONG_THRESHOLD" min="0" max="1023" class="ten columns">
                </div>
            </div>

            <br/>
            <br/>
            <button id="sip-puff-button" onclick="save()" class="u-full-width">
                <div id="sip-puff-button-normal" data-translatable>Save // Speichern</div>
                <div id="sip-puff-button-saving" style="display: none" data-translatable>Saving... // Wird gespeichert...</div>
            </button>
        </div>
        <div data-tabs-pane class="tabs-pane" id="tabActions">
            <div class="empty-separator"></div>

            <label for="action-1">Select an action:</label>
            <select id="actioncommand">
                <option selected="selected" value="CL">Click Left</option>
                <option value="CR">Click Right</option>
                <option value="PL">Press (Hold) Left</option>
                <option value="KW">Write Keyboard</option>
            </select>
            <label for="action-2">additional paramters (text or value):</label>
            <input type="text" data-clear-btn="true" name="actionparameter" id="actionparameter" value="">
            <div class="empty-separator"></div>
            <input type="button" id="action-button" value="Learn Gesture">
        </div>
    </div>
</div>

<script>
    window.onload = function () {
        var flip = new FlipMouse(function (config) {
            setSliderValue(flip.SENSITIVITY_X, config[flip.SENSITIVITY_X]);
            setSliderValue(flip.SENSITIVITY_Y, config[flip.SENSITIVITY_Y]);
            setSliderValue(flip.DEADZONE_X, config[flip.DEADZONE_X]);
            setSliderValue(flip.DEADZONE_Y, config[flip.DEADZONE_Y]);
            setSliderValue(flip.SIP_THRESHOLD, config[flip.SIP_THRESHOLD]);
            setSliderValue(flip.SIP_STRONG_THRESHOLD, config[flip.SIP_STRONG_THRESHOLD]);
            setSliderValue(flip.PUFF_THRESHOLD, config[flip.PUFF_THRESHOLD]);
            setSliderValue(flip.PUFF_STRONG_THRESHOLD, config[flip.PUFF_STRONG_THRESHOLD]);
            console.log(config);

            flip.setLiveValueHandler(function (data) {
                var min = data[flip.LIVE_PRESSURE_MIN];
                var max = data[flip.LIVE_PRESSURE_MAX];
                var val = data[flip.LIVE_PRESSURE];

                var border = 10; // space that is left and right of the min/max values on the sliders
                var currentMinRange = Math.max(Math.min(min - border, flip.getConfig()[flip.SIP_THRESHOLD] - border, flip.getConfig()[flip.SIP_STRONG_THRESHOLD] - border), 0);
                var currentMaxRange = Math.min(Math.max(max + border, flip.getConfig()[flip.PUFF_THRESHOLD] + border, flip.getConfig()[flip.PUFF_STRONG_THRESHOLD] + border), 1023);
                var percent = L.getPercentage(val, currentMinRange, currentMaxRange);
                var percentMin = L.getPercentage(min, currentMinRange, currentMaxRange);
                var percentMax = L.getPercentage(max, currentMinRange, currentMaxRange);

                L('#maxValue').innerHTML = max;
                L('#minValue').innerHTML = min;
                L('#currentValue').innerHTML = val;

                L('#guide-max').style = 'width: ' + percentMax + '%;';
                L('#guide-min').style = 'width: ' + percentMin + '%;';

                L('#value-bar').style = 'width: ' + percent + '%;';
                L('#guide-current').style = 'width: ' + percent + '%;';

                //set slider ranges
                flip.SIP_PUFF_IDS.forEach(function (id) {
                    L(id).min = currentMinRange;
                    L(id).max = currentMaxRange;
                });
            });
        });
        window.flip = flip;
    };

    function sliderChanged(evt) {
        setSliderValue(evt.currentTarget.id, evt.currentTarget.value, true);
        window.flip.setValue(evt.currentTarget.id, evt.currentTarget.value);
    }

    function setSliderValue(constant, value, dontSetSlider) {
        L('#' + constant + '_VAL').innerHTML = value;
        if(!dontSetSlider) {
            L('#' + constant).value = value;
        }
    }

    function save() {
        L.toggle('#basic-button-normal', '#basic-button-saving', '#sip-puff-button-normal', '#sip-puff-button-saving');
        window.flip.save().then(function (success) {
            if(success) {
                L.toggle('#basic-button-normal', '#basic-button-saving', '#sip-puff-button-normal', '#sip-puff-button-saving');
            }
        });
    }
</script>
<script>
    tabby.init();
    domI18n({
        selector: '[data-translatable]',
        separator: ' // ',
        languages: ['en', 'de']
    });
</script>
</body>
</html>